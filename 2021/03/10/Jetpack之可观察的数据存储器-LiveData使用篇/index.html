<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-material.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tinlone.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="LiveData æ˜¯ä¸€ç§å¯è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨å™¨ç±»ã€‚ä¸å¸¸è§„çš„å¯è§‚å¯Ÿç±»ä¸åŒï¼ŒLiveData å…·æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥èƒ½åŠ›ï¼Œæ„æŒ‡å®ƒéµå¾ªå…¶ä»–åº”ç”¨ç»„ä»¶ï¼ˆå¦‚ Activityã€Fragment æˆ– Serviceï¼‰çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™ç§æ„ŸçŸ¥èƒ½åŠ›å¯ç¡®ä¿ LiveData ä»…æ›´æ–°å¤„äºæ´»è·ƒç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„åº”ç”¨ç»„ä»¶è§‚å¯Ÿè€…ã€‚  ã€æœ¬ç³»åˆ—æ–‡ç« (JAVA&#x2F;KOTLIN)æ¼”ç¤ºæ¡ˆä¾‹å‡å­˜å‚¨åœ¨githubå­˜å‚¨åº“ArchitecturalCompo">
<meta property="og:type" content="article">
<meta property="og:title" content="Jetpackä¹‹å¯è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨å™¨-LiveDataä½¿ç”¨ç¯‡">
<meta property="og:url" content="http://tinlone.com/2021/03/10/Jetpack%E4%B9%8B%E5%8F%AF%E8%A7%82%E5%AF%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%99%A8-LiveData%E4%BD%BF%E7%94%A8%E7%AF%87/index.html">
<meta property="og:site_name" content="Tinlone">
<meta property="og:description" content="LiveData æ˜¯ä¸€ç§å¯è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨å™¨ç±»ã€‚ä¸å¸¸è§„çš„å¯è§‚å¯Ÿç±»ä¸åŒï¼ŒLiveData å…·æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥èƒ½åŠ›ï¼Œæ„æŒ‡å®ƒéµå¾ªå…¶ä»–åº”ç”¨ç»„ä»¶ï¼ˆå¦‚ Activityã€Fragment æˆ– Serviceï¼‰çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™ç§æ„ŸçŸ¥èƒ½åŠ›å¯ç¡®ä¿ LiveData ä»…æ›´æ–°å¤„äºæ´»è·ƒç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„åº”ç”¨ç»„ä»¶è§‚å¯Ÿè€…ã€‚  ã€æœ¬ç³»åˆ—æ–‡ç« (JAVA&#x2F;KOTLIN)æ¼”ç¤ºæ¡ˆä¾‹å‡å­˜å‚¨åœ¨githubå­˜å‚¨åº“ArchitecturalCompo">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-10T12:06:34.401Z">
<meta property="article:modified_time" content="2021-03-10T12:05:17.823Z">
<meta property="article:author" content="Tinlone">
<meta property="article:tag" content="LiveData">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://tinlone.com/2021/03/10/Jetpack%E4%B9%8B%E5%8F%AF%E8%A7%82%E5%AF%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%99%A8-LiveData%E4%BD%BF%E7%94%A8%E7%AF%87/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Jetpackä¹‹å¯è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨å™¨-LiveDataä½¿ç”¨ç¯‡ | Tinlone</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Tinlone</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">å •è½çš„ğŸŸ</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://tinlone.com/2021/03/10/Jetpack%E4%B9%8B%E5%8F%AF%E8%A7%82%E5%AF%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%99%A8-LiveData%E4%BD%BF%E7%94%A8%E7%AF%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon-32x32-next.png">
      <meta itemprop="name" content="Tinlone">
      <meta itemprop="description" content="Tinloneçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tinlone">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Jetpackä¹‹å¯è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨å™¨-LiveDataä½¿ç”¨ç¯‡
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-10 20:06:34 / ä¿®æ”¹æ—¶é—´ï¼š20:05:17" itemprop="dateCreated datePublished" datetime="2021-03-10T20:06:34+08:00">2021-03-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Jetpack/" itemprop="url" rel="index"><span itemprop="name">Jetpack</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>3.1k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>3 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>LiveData æ˜¯ä¸€ç§å¯è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨å™¨ç±»ã€‚ä¸å¸¸è§„çš„å¯è§‚å¯Ÿç±»ä¸åŒï¼ŒLiveData å…·æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥èƒ½åŠ›ï¼Œæ„æŒ‡å®ƒéµå¾ªå…¶ä»–åº”ç”¨ç»„ä»¶ï¼ˆå¦‚ Activityã€Fragment æˆ– Serviceï¼‰çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™ç§æ„ŸçŸ¥èƒ½åŠ›å¯ç¡®ä¿ LiveData ä»…æ›´æ–°å¤„äºæ´»è·ƒç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„åº”ç”¨ç»„ä»¶è§‚å¯Ÿè€…ã€‚</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/TinloneX/ArchitecturalComponentExample">ã€æœ¬ç³»åˆ—æ–‡ç« (JAVA/KOTLIN)æ¼”ç¤ºæ¡ˆä¾‹å‡å­˜å‚¨åœ¨githubå­˜å‚¨åº“ArchitecturalComponentExampleä¸­ã€‘</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/livedata#create_livedata_objects">ã€å¦‚éœ€å‚è€ƒLiveDataå®˜æ–¹æ–‡æ¡£è¯·ç§»æ­¥æ­¤å¤„ã€‘</a></p>
<a id="more"></a>

<h4 id="LiveDataçš„ä¼˜åŠ¿"><a href="#LiveDataçš„ä¼˜åŠ¿" class="headerlink" title="LiveDataçš„ä¼˜åŠ¿"></a>LiveDataçš„ä¼˜åŠ¿</h4><p>åœ¨æ­£å¼ä½¿ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹å…¶ä¼˜åŠ¿ï¼ˆå³æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒï¼‰ï¼Œä»¥ä¸‹å¼•ç”¨å–è‡ªå®˜æ–¹æ–‡æ¡£ï¼š</p>
<p><strong>ç¡®ä¿ç•Œé¢ç¬¦åˆæ•°æ®çŠ¶æ€</strong></p>
<blockquote>
<p>LiveData éµå¾ªè§‚å¯Ÿè€…æ¨¡å¼ã€‚å½“åº•å±‚æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒLiveData ä¼šé€šçŸ¥ Observer å¯¹è±¡ã€‚æ‚¨å¯ä»¥æ•´åˆä»£ç ä»¥åœ¨è¿™äº› Observer å¯¹è±¡ä¸­æ›´æ–°ç•Œé¢ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ‚¨æ— éœ€åœ¨æ¯æ¬¡åº”ç”¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶æ›´æ–°ç•Œé¢ï¼Œå› ä¸ºè§‚å¯Ÿè€…ä¼šæ›¿æ‚¨å®Œæˆæ›´æ–°ã€‚</p>
</blockquote>
<p><strong>ä¸ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼</strong></p>
<blockquote>
<p>è§‚å¯Ÿè€…ä¼šç»‘å®šåˆ° Lifecycle å¯¹è±¡ï¼Œå¹¶åœ¨å…¶å…³è”çš„ç”Ÿå‘½å‘¨æœŸé­åˆ°é”€æ¯åè¿›è¡Œè‡ªæˆ‘æ¸…ç†ã€‚</p>
</blockquote>
<p><strong>ä¸ä¼šå›  Activity åœæ­¢è€Œå¯¼è‡´å´©æºƒ</strong></p>
<blockquote>
<p>å¦‚æœè§‚å¯Ÿè€…çš„ç”Ÿå‘½å‘¨æœŸå¤„äºéæ´»è·ƒçŠ¶æ€ï¼ˆå¦‚è¿”å›æ ˆä¸­çš„ Activityï¼‰ï¼Œåˆ™å®ƒä¸ä¼šæ¥æ”¶ä»»ä½• LiveData äº‹ä»¶ã€‚</p>
</blockquote>
<p><strong>ä¸å†éœ€è¦æ‰‹åŠ¨å¤„ç†ç”Ÿå‘½å‘¨æœŸ</strong></p>
<blockquote>
<p>ç•Œé¢ç»„ä»¶åªæ˜¯è§‚å¯Ÿç›¸å…³æ•°æ®ï¼Œä¸ä¼šåœæ­¢æˆ–æ¢å¤è§‚å¯Ÿã€‚LiveData å°†è‡ªåŠ¨ç®¡ç†æ‰€æœ‰è¿™äº›æ“ä½œï¼Œå› ä¸ºå®ƒåœ¨è§‚å¯Ÿæ—¶å¯ä»¥æ„ŸçŸ¥ç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€å˜åŒ–ã€‚</p>
</blockquote>
<p><strong>æ•°æ®å§‹ç»ˆä¿æŒæœ€æ–°çŠ¶æ€</strong></p>
<blockquote>
<p>å¦‚æœç”Ÿå‘½å‘¨æœŸå˜ä¸ºéæ´»è·ƒçŠ¶æ€ï¼Œå®ƒä¼šåœ¨å†æ¬¡å˜ä¸ºæ´»è·ƒçŠ¶æ€æ—¶æ¥æ”¶æœ€æ–°çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæ›¾ç»åœ¨åå°çš„ Activity ä¼šåœ¨è¿”å›å‰å°åç«‹å³æ¥æ”¶æœ€æ–°çš„æ•°æ®ã€‚</p>
</blockquote>
<p><strong>é€‚å½“çš„é…ç½®æ›´æ”¹</strong></p>
<blockquote>
<p>å¦‚æœç”±äºé…ç½®æ›´æ”¹ï¼ˆå¦‚è®¾å¤‡æ—‹è½¬ï¼‰è€Œé‡æ–°åˆ›å»ºäº† Activity æˆ– Fragmentï¼Œå®ƒä¼šç«‹å³æ¥æ”¶æœ€æ–°çš„å¯ç”¨æ•°æ®ã€‚</p>
</blockquote>
<p><strong>å…±äº«èµ„æº</strong></p>
<blockquote>
<p>æ‚¨å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼æ‰©å±• LiveData å¯¹è±¡ä»¥å°è£…ç³»ç»ŸæœåŠ¡ï¼Œä»¥ä¾¿åœ¨åº”ç”¨ä¸­å…±äº«å®ƒä»¬ã€‚LiveData å¯¹è±¡è¿æ¥åˆ°ç³»ç»ŸæœåŠ¡ä¸€æ¬¡ï¼Œç„¶åéœ€è¦ç›¸åº”èµ„æºçš„ä»»ä½•è§‚å¯Ÿè€…åªéœ€è§‚å¯Ÿ LiveData å¯¹è±¡ã€‚å¦‚éœ€äº†è§£è¯¦æƒ…ï¼Œè¯·å‚é˜…æ‰©å±• LiveDataã€‚ </p>
</blockquote>
<h4 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h4><p>LiveDataä½œä¸ºç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ç»„ä»¶ï¼Œå®ƒçš„ä¾èµ–åŒ…ä¹Ÿæ˜¯ lifecycleæ—ç³»ï¼Œé€šå¸¸çš„ï¼Œæˆ‘ä»¬å¸¸å¸¸å°†LiveDataé…åˆViewModelä½¿ç”¨ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å•ç‹¬ä½¿ç”¨LiveDataä¾èµ–ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def lifecycle_version &#x3D; &quot;2.3.0&quot;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å¦‚æœä½ éœ€è¦é…åˆViewModelä½¿ç”¨ï¼Œè¯·åŠ ä¸Š</span><br><span class="line">implementation &quot;androidx.lifecycle:lifecycle-viewmodel-ktx:$lifecycle_version&quot;</span><br><span class="line">&#x2F;&#x2F; LiveData</span><br><span class="line">implementation &quot;androidx.lifecycle:lifecycle-livedata-ktx:$lifecycle_version&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ­¤æ–‡æ¼”ç¤ºé¡¹ç›®ä¸ºViewModel+LiveDataï¼Œå¦‚æœ‰å¯¹ViewModelä¸äº†è§£çš„å¯ä»¥é€šè¿‡<a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/viewmodel">ã€å®˜æ–¹æ–‡æ¡£ã€‘</a>æˆ–<a href="https://tinlone.com/2021/03/07/Jetpack%E4%B9%8B%E7%95%8C%E9%9D%A2%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%BB%84%E4%BB%B6-ViewModel/">ã€Jetpackä¹‹ç•Œé¢æ•°æ®å­˜å‚¨ç»„ä»¶-ViewModelã€‘</a>å…·ä½“äº†è§£ã€‚</p>
<blockquote>
<p>è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ä½¿ç”¨ LiveData å¯¹è±¡ï¼š</p>
<ul>
<li>åˆ›å»º LiveData çš„å®ä¾‹ä»¥å­˜å‚¨æŸç§ç±»å‹çš„æ•°æ®ã€‚è¿™é€šå¸¸åœ¨ ViewModel ç±»ä¸­å®Œæˆã€‚</li>
<li>åˆ›å»ºå¯å®šä¹‰ onChanged() æ–¹æ³•çš„ Observer å¯¹è±¡ï¼Œè¯¥æ–¹æ³•å¯ä»¥æ§åˆ¶å½“ LiveData å¯¹è±¡å­˜å‚¨çš„æ•°æ®æ›´æ”¹æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥åœ¨ç•Œé¢æ§åˆ¶å™¨ï¼ˆå¦‚ Activity æˆ– Fragmentï¼‰ä¸­åˆ›å»º Observer å¯¹è±¡ã€‚</li>
<li>ä½¿ç”¨ observe() æ–¹æ³•å°† Observer å¯¹è±¡é™„åŠ åˆ° LiveData å¯¹è±¡ã€‚observe() æ–¹æ³•ä¼šé‡‡ç”¨ LifecycleOwner å¯¹è±¡ã€‚è¿™æ ·ä¼šä½¿ Observer å¯¹è±¡è®¢é˜… LiveData å¯¹è±¡ï¼Œä»¥ä½¿å…¶æ”¶åˆ°æœ‰å…³æ›´æ”¹çš„é€šçŸ¥ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥åœ¨ç•Œé¢æ§åˆ¶å™¨ï¼ˆå¦‚ Activity æˆ– Fragmentï¼‰ä¸­é™„åŠ  Observer å¯¹è±¡ã€‚</li>
</ul>
</blockquote>
<h4 id="åˆ›å»ºLiveData"><a href="#åˆ›å»ºLiveData" class="headerlink" title="åˆ›å»ºLiveData"></a>åˆ›å»ºLiveData</h4><p>åˆ›å»ºLiveDataçš„æ–¹å¼éå¸¸ç®€å•ï¼Œä½ åªéœ€è¦ç›´æ¥newå‡ºä»–çš„å­ç±»å¹¶ä¼ å…¥ä½ æƒ³è¦è§‚å¯Ÿçš„æ•°æ®ç±»å‹æ³›å‹å³å¯ï¼ŒLiveDataæä¾›<code>setValue(T t) & postValue(T t)</code>ç”¨ä»¥æ›´æ–°å€¼, å¯ä»¥ä½¿ç”¨<code>T getValue()</code>è·å–å€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MutableLiveData&lt;Integer&gt; price = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line"><span class="comment">// å½“ç„¶ä½ ä¹Ÿå¯ä»¥è¿™æ ·</span></span><br><span class="line">MutableLiveData&lt;Seller&gt; mSeller = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line"><span class="comment">// å®šä¹‰æ›´æ–°LiveDataå€¼çš„æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">countUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼Œåœ¨åˆå§‹æ—¶LiveDataä¸­åŒ…å«çš„æ•°æ®å¯èƒ½ä¸ºç©ºï¼Œä½ éœ€è¦ä¸ºå®ƒè®¾ç½®å€¼</span></span><br><span class="line">    price.setValue(price.getValue() == <span class="keyword">null</span> ? <span class="number">0</span> : price.getValue() + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="è§‚å¯ŸLiveData"><a href="#è§‚å¯ŸLiveData" class="headerlink" title="è§‚å¯ŸLiveData"></a>è§‚å¯ŸLiveData</h4><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”ç”¨ç»„ä»¶çš„ onCreate() æ–¹æ³•æ˜¯å¼€å§‹è§‚å¯Ÿ LiveData å¯¹è±¡çš„æ­£ç¡®ç€æ‰‹ç‚¹ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç¡®ä¿ç³»ç»Ÿä¸ä¼šä» Activity æˆ– Fragment çš„ onResume() æ–¹æ³•è¿›è¡Œå†—ä½™è°ƒç”¨ã€‚</li>
<li>ç¡®ä¿ Activity æˆ– Fragment å˜ä¸ºæ´»è·ƒçŠ¶æ€åå…·æœ‰å¯ä»¥ç«‹å³æ˜¾ç¤ºçš„æ•°æ®ã€‚ä¸€æ—¦åº”ç”¨ç»„ä»¶å¤„äº STARTED çŠ¶æ€ï¼Œå°±ä¼šä»å®ƒæ­£åœ¨è§‚å¯Ÿçš„ LiveData å¯¹è±¡æ¥æ”¶æœ€æ–°å€¼ã€‚åªæœ‰åœ¨è®¾ç½®äº†è¦è§‚å¯Ÿçš„ LiveData å¯¹è±¡æ—¶ï¼Œæ‰ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚</li>
</ul>
<p>LiveDataè®¢é˜…<code>observe(@NonNull LifecycleOwner owner, @NonNull Observer<? super T> observer)</code>éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œç”Ÿå‘½å‘¨æœŸæ‹¥æœ‰è€…LifecycleOwnerå’Œè§‚å¯Ÿè€…Observerã€‚</p>
<p>ä¸€èˆ¬çš„ï¼Œç»§æ‰¿è‡ªAndroidXåŒ…ä¸­çš„Activity/Fragmentç»„ä»¶(api &gt;= 26)å·²è‡ªè¡Œå®ç°LifecycleOwnerã€‚</p>
<p><em>åœ¨æœªå¼ºè°ƒè¯´æ˜çš„æƒ…å†µä¸‹ï¼Œæœ¬æ–‡ä»£ç å—å‡ä¿æŒä½¿ç”¨Java8ç‰¹æ€§ã€‚</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å»ºç«‹è®¢é˜…å…³ç³»</span></span><br><span class="line">viewModel.price.observe(<span class="keyword">this</span>, <span class="keyword">this</span>::updatePriceButton);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰Observer.onChanged(T t)å›è°ƒæ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updatePriceButton</span><span class="params">(<span class="keyword">int</span> price)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// åœ¨æœªå¼ºè°ƒæ—¶ï¼Œæ­¤å¤„å‡ä¸ºæ—¥å¿—æ‰“å°ï¼Œè¯¦ç»†ä»£ç è§Demo</span></span><br><span class="line">   <span class="comment">// åç»­ä»£ç å—ä¸­å°†ç®€åŒ–æˆ–ä¸å†™ç±»ä¼¼å®ç°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªonClickè§¦å‘LiveDataå€¼çš„æ›´æ–°</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">countUp</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">    viewModel.countUp();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ‰§è¡Œæ•ˆæœï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è®¢é˜…æ•°æ®å˜åŒ–ğŸ‘‰ 0</span><br><span class="line">è®¢é˜…æ•°æ®å˜åŒ–ğŸ‘‰ 1</span><br><span class="line">è®¢é˜…æ•°æ®å˜åŒ–ğŸ‘‰ 2</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬æ”¹å˜è¢«è§‚å¯Ÿçš„å€¼æ—¶ï¼Œæˆ‘ä»¬çš„è§‚å¯Ÿè€…ä¹Ÿå¦‚é¢„æœŸè¢«é€šçŸ¥åˆ°äº†ï¼Œè¿™æ ·ä¾¿å®ç°äº†æœ€ç®€LiveDataæ•°æ®è§‚å¯Ÿæµç¨‹ï¼ˆè¯¦ç»†ä»£ç <a target="_blank" rel="noopener" href="https://github.com/TinloneX/ArchitecturalComponentExample/tree/main/LiveDataExample/LiveDataExampleJava/app/src/main/java/com/tinlone/livedataexamplejava">ã€Javaç¤ºä¾‹è¯·å‚è§æ­¤å¤„ã€‘</a>ã€<a target="_blank" rel="noopener" href="https://github.com/TinloneX/ArchitecturalComponentExample/tree/main/LiveDataExample/LiveDataExampleKotlin/app/src/main/java/com/tinlone/livedataexamplekotlin">ã€Kotlinç¤ºä¾‹è¯·å‚è§æ­¤å¤„ã€‘</a>ï¼‰ã€‚</p>
<h4 id="æ‰©å±•LiveData"><a href="#æ‰©å±•LiveData" class="headerlink" title="æ‰©å±•LiveData"></a>æ‰©å±•LiveData</h4><p>ä½ å¯ä»¥ç»§æ‰¿LiveDataè‡ªè¡Œå®ç°LiveDataçš„æ•°æ®å˜æ›´çŠ¶æ€çš„åˆ†å‘ï¼Œå·²æ¼”ç¤ºé¡¹ç›®ä¸ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPriceLiveData</span> <span class="keyword">extends</span> <span class="title">LiveData</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;LiveDataExampleLog&quot;</span>;</span><br><span class="line">    <span class="comment">// æ­¤å¤„å®šä¹‰ç›‘å¬ï¼Œç›‘å¬è§¦å‘æ—¶è°ƒç”¨ setValue(T t)æ–¹æ³•</span></span><br><span class="line">    PriceManager.PriceListener listener = <span class="keyword">this</span>::setValue;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// åŒæ ·çš„ä½ å¯ä»¥å°†LiveDataè®¾ç½®æˆå•ä¾‹ï¼Œæ­¤å¤„ä¸åšå®ç°</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ­¤å¤„å®šä¹‰ç”Ÿå‘½å‘¨æœŸå¤„äº STARTED æˆ– RESUMED çŠ¶æ€æ—¶çš„æ“ä½œ</span></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;MyPriceLiveData.onActive&quot;</span>);</span><br><span class="line">        PriceManager.getInstance().requestPriceUpdate(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onInactive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;MyPriceLiveData.onInactive&quot;</span>);</span><br><span class="line">        <span class="comment">// æ­¤å¤„å®šä¹‰æ²¡æœ‰ä»»ä½•æ´»è·ƒè§‚å¯Ÿè€…æ—¶ï¼Œè§£é™¤å¯¹PriceManagerçš„å…³è”</span></span><br><span class="line">        PriceManager.getInstance().removeUpdateListener(listener);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åƒå…ˆå‰ä¸€æ ·ä½¿ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; ViewModelä¸­</span><br><span class="line">private final PriceManager priceManager &#x3D; PriceManager.getInstance();</span><br><span class="line">MyPriceLiveData extensionData &#x3D; new MyPriceLiveData();</span><br><span class="line"></span><br><span class="line">public void updatePriceForExtension() &#123;</span><br><span class="line">    priceManager.updatePrice(priceManager.price + 1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Activity&#x2F;Fragmentä¸­</span><br><span class="line">&#x2F;&#x2F; è®¢é˜…LiveDataæ‰©å±•</span><br><span class="line">viewModel.extensionData.observe(this, this::updateExtensionButton);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ç‚¹å‡»äº‹ä»¶è§¦å‘å€¼æ›´æ–°</span><br><span class="line">public void extensionData(View view) &#123;</span><br><span class="line">    viewModel.updatePriceForExtension();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿è¡ŒæŸ¥çœ‹ç»“æœï¼Œå¹¶åšæ¯å±äº®å±æ“ä½œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; ç‚¹å‡»æŒ‰é’®</span><br><span class="line">æµ‹è¯•æ‰©å±•LiveDatağŸ‘‰ 1</span><br><span class="line">æµ‹è¯•æ‰©å±•LiveDatağŸ‘‰ 2</span><br><span class="line">&#x2F;&#x2F; æ¯å±</span><br><span class="line">MyPriceLiveData.onInactive</span><br><span class="line">&#x2F;&#x2F; äº®å±</span><br><span class="line">MyPriceLiveData.onActive</span><br><span class="line">&#x2F;&#x2F; æ­¤å¤„PriceManageræœªåšå€¼æœªæ”¹å˜æ—¶ä¸æ›´æ–°çš„é™åˆ¶ï¼Œæ•…ä¼šé‡æ–°åˆ†å‘å€¼å˜åŒ–</span><br><span class="line">æµ‹è¯•æ‰©å±•LiveDatağŸ‘‰ 2</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çš„æ‰©å±•LiveDataä¼šåœ¨æ¯å±/äº®å±æ—¶è§¦å‘<code> onInactive()/ onActive()</code>å›è°ƒï¼Œä»è€Œæ‰§è¡Œæˆ‘ä»¬çš„è‡ªå®šä¹‰å®ç°ä»£ç ã€‚</p>
<h4 id="è½¬æ¢-LiveData"><a href="#è½¬æ¢-LiveData" class="headerlink" title="è½¬æ¢ LiveData"></a>è½¬æ¢ LiveData</h4><p>LiveDataä¸ºæˆ‘ä»¬æä¾›äº†æ•°æ®è½¬æ¢åŠŸèƒ½ï¼ŒåŒ…å«<code>Transformations.map()</code>ã€<code>Transformations.switchMap()</code>ä¸¤ç§æ–¹å¼ï¼Œå…¶è°ƒç”¨æ–¹å¼ä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äº map() çš„ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¯ç†è§£ä¸ºè½¬æ¢å™¨ï¼‰éœ€è¿”å›æ³›å‹Tï¼Œè€ŒswitchMap() çš„ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¯ç†è§£ä¸ºè½¬æ¢å™¨ï¼‰éœ€è¿”å›LiveData<T>ã€‚</p>
<p>map()è½¬æ¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ViewModelä¸­</span></span><br><span class="line">MutableLiveData&lt;Integer&gt; priceForMap = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line"><span class="comment">// è§‚å¯Ÿpriceå¹¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„å¯è§‚å¯Ÿå¯¹è±¡</span></span><br><span class="line">LiveData&lt;String&gt; userThink = Transformations.map(priceForMap,</span><br><span class="line">        price -&gt; price + (price % <span class="number">2</span> == <span class="number">0</span> ? <span class="string">&quot;å—åˆšåˆšå¥½&quot;</span> : <span class="string">&quot;å—è´µäº†&quot;</span>));</span><br><span class="line"><span class="comment">// æ›´æ–°priceå€¼</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPriceForMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    priceForMap.setValue(priceForMap.getValue() == <span class="keyword">null</span> ? <span class="number">0</span> : priceForMap.getValue() + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Activity/Fragmentä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="comment">// æ•°æ®è½¬æ¢ è®¢é˜…ä»·æ ¼çš„è½¬æ¢ =&gt; ç”¨æˆ·ä»·æ ¼æ„ŸçŸ¥</span></span><br><span class="line">viewModel.userThink.observe(<span class="keyword">this</span>, <span class="keyword">this</span>::updateUserThinkButton);</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ‰§è¡Œè§‚å¯Ÿç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è½¬æ¢æ•°æ®(map)ğŸ‘‰ 0å—åˆšåˆšå¥½</span><br><span class="line">è½¬æ¢æ•°æ®(map)ğŸ‘‰ 1å—è´µäº†</span><br><span class="line">è½¬æ¢æ•°æ®(map)ğŸ‘‰ 2å—åˆšåˆšå¥½</span><br></pre></td></tr></table></figure>
<p>switchMap()è½¬æ¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è½¬æ¢å‰çš„LiveData</span></span><br><span class="line">MutableLiveData&lt;Integer&gt; priceForSwitch = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line"><span class="comment">// è½¬æ¢åçš„ç›®æ ‡LiveData</span></span><br><span class="line">MutableLiveData&lt;String&gt; sellerThink = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> MutableLiveData&lt;String&gt; <span class="title">getSellerThink</span><span class="params">(<span class="keyword">int</span> price)</span> </span>&#123;</span><br><span class="line">    String think = price + (price &lt;= <span class="number">3</span> ? <span class="string">&quot;ç©·é¬¼&quot;</span> : <span class="string">&quot;å†¤å¤§å¤´&quot;</span>);</span><br><span class="line">    sellerThink.setValue(think);</span><br><span class="line">    <span class="keyword">return</span> sellerThink;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ›´æ–°priceå€¼</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPriceForSeller</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    priceForSwitch.setValue(priceForSwitch.getValue() == <span class="keyword">null</span> ? <span class="number">0</span> : priceForSwitch.getValue() + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è½¬æ¢ç»“æœLiveData</span></span><br><span class="line">LiveData&lt;String&gt; switchToUserLook = Transformations.switchMap(priceForSwitch, <span class="keyword">this</span>::getSellerThink);</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨æ–¹å¼ä¸map()ä¸€è‡´ï¼Œä½ å¯ä»¥å¯¹è½¬æ¢åçš„LiveDataè§‚æµ‹ï¼Œä¹Ÿå¯ä»¥å¯¹è½¬æ¢ç»“æœLiveDataè§‚æµ‹ï¼Œæ­¤å¤„çœç•¥ï¼Œæˆ‘ä»¬æ¥è§‚å¯Ÿå…¶æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘æ˜¯å•†å®¶æƒ³æ³•çš„è®¢é˜…ï¼š0ç©·é¬¼</span><br><span class="line">è½¬æ¢æ•°æ®(switchMap)ğŸ‘‰ 0ç©·é¬¼</span><br><span class="line">æˆ‘æ˜¯å•†å®¶æƒ³æ³•çš„è®¢é˜…ï¼š1ç©·é¬¼</span><br><span class="line">è½¬æ¢æ•°æ®(switchMap)ğŸ‘‰ 1ç©·é¬¼</span><br></pre></td></tr></table></figure>
<p>å¯¹è½¬æ¢åçš„LiveDataè§‚æµ‹åŠä»¥å¯¹è½¬æ¢ç»“æœLiveDataè§‚æµ‹å‡èƒ½æ”¶åˆ°å“åº”ã€‚ä¸ºåˆ¤æ–­2ä¸ªLiveDataæ˜¯å¦è§‚å¯Ÿçš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å°†è½¬æ¢åçš„ç›®æ ‡åŠç»“æœæ”¹é€ ä¸ºå¯¹è±¡ï¼Œè§‚å¯Ÿå…¶hashCodeæ˜¯å¦ç›¸ç­‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è½¬æ¢åçš„ç›®æ ‡LiveData</span></span><br><span class="line">MutableLiveData&lt;Seller&gt; mSeller = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line"><span class="comment">// è½¬æ¢ç»“æœLiveData</span></span><br><span class="line">LiveData&lt;Seller&gt; switchToSeller = Transformations.switchMap(priceForSeller, <span class="keyword">this</span>::getSeller);</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè§‚å¯Ÿç»“æœæ‰“å°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è®¢é˜…çš„Seller.hashCode() &#x3D; 84056966</span><br><span class="line">viewModel.mSeller.getValue().hashCode() &#x3D; 84056966</span><br><span class="line">viewModel.switchToSeller.getValue().hashCode() &#x3D; 84056966</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°ï¼Œè½¬æ¢åçš„ç›®æ ‡LiveDataåŠè½¬æ¢ç»“æœLiveDataå®é™…è§‚å¯Ÿå¯¹è±¡ä¸ºåŒä¸€ä¸ªï¼Œä¸ä¼šä¸ºæ•°æ®åˆ›å»ºå‰¯æœ¬ã€‚</p>
<h4 id="åˆå¹¶LiveData"><a href="#åˆå¹¶LiveData" class="headerlink" title="åˆå¹¶LiveData"></a>åˆå¹¶LiveData</h4><blockquote>
<p>MediatorLiveData æ˜¯ LiveData çš„å­ç±»ï¼Œå…è®¸æ‚¨åˆå¹¶å¤šä¸ª LiveData æºã€‚åªè¦ä»»ä½•åŸå§‹çš„ LiveData æºå¯¹è±¡å‘ç”Ÿæ›´æ”¹ï¼Œå°±ä¼šè§¦å‘ MediatorLiveData å¯¹è±¡çš„è§‚å¯Ÿè€…ã€‚</p>
</blockquote>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªåˆå¹¶LiveDataæºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MediatorLiveData&lt;Object&gt; mediatorLiveData = <span class="keyword">new</span> MediatorLiveData&lt;&gt;();</span><br></pre></td></tr></table></figure>
<p>å¹¶åœ¨ä½¿ç”¨æ—¶ï¼Œä¸ºå…¶æ·»åŠ è§‚å¯Ÿçš„LiveDataæºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå¹¶è§‚å¯Ÿ1</span></span><br><span class="line">viewModel.mediatorLiveData.addSource(viewModel.switchToSeller, <span class="keyword">this</span>::onMediatorData);</span><br><span class="line"><span class="comment">// åˆå¹¶è§‚å¯Ÿ2</span></span><br><span class="line">viewModel.mediatorLiveData.addSource(viewModel.userThink, <span class="keyword">this</span>::onMediatorData);</span><br><span class="line"><span class="comment">// è§‚å¯Ÿæ•°æ®åˆå¹¶</span></span><br><span class="line">viewModel.mediatorLiveData.observe(<span class="keyword">this</span>,<span class="keyword">this</span>::onMediatorData);</span><br><span class="line"></span><br><span class="line"><span class="keyword">boolean</span> mediatorFlag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§¦å‘ä¸åŒçš„æ•°æ®æ›´æ–°</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mediatorData</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mediatorFlag) &#123;</span><br><span class="line">        viewModel.setPriceForSeller();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        viewModel.setPriceForMap();</span><br><span class="line">    &#125;</span><br><span class="line">    mediatorFlag = !mediatorFlag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è§‚å¯Ÿå…¶æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; ç¬¬ä¸€æ¬¡è§¦å‘</span><br><span class="line">è½¬æ¢æ•°æ®(map)ğŸ‘‰ 0å—åˆšåˆšå¥½</span><br><span class="line">åˆå¹¶æ•°æ®ğŸ‘‰ 0å—åˆšåˆšå¥½</span><br><span class="line">&#x2F;&#x2F; ç¬¬äºŒæ¬¡è§¦å‘</span><br><span class="line">æˆ‘æ˜¯å•†å®¶æƒ³æ³•çš„è®¢é˜…ï¼š0ç©·é¬¼</span><br><span class="line">åˆå¹¶æ•°æ®ğŸ‘‰ 0ç©·é¬¼</span><br><span class="line">è½¬æ¢æ•°æ®(switchMap)ğŸ‘‰ 0ç©·é¬¼</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°ï¼Œåœ¨è§¦å‘å•ä¸ªLiveDataå€¼å˜åŒ–æ—¶é™¤äº†å…¶æœ¬èº«LiveDataçš„è§‚å¯Ÿè€…è¢«è§¦å‘ï¼Œåˆå¹¶æ•°æ®çš„è§‚å¯Ÿè€…ä¹Ÿä¼šè¢«è§¦å‘ã€‚</p>
<p>å¯¹äºæ­¤APIçš„åº”ç”¨åœºæ™¯ï¼Œå®˜æ–¹æœ‰æå‡ºä»¥ä¸‹åœºæ™¯ï¼š</p>
<blockquote>
<p>ä¾‹å¦‚ï¼Œå¦‚æœç•Œé¢ä¸­æœ‰å¯ä»¥ä»æœ¬åœ°æ•°æ®åº“æˆ–ç½‘ç»œæ›´æ–°çš„ LiveData å¯¹è±¡ï¼Œåˆ™å¯ä»¥å‘ MediatorLiveData å¯¹è±¡æ·»åŠ ä»¥ä¸‹æºï¼š</p>
<ul>
<li>ä¸å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®å…³è”çš„ LiveData å¯¹è±¡ã€‚</li>
<li>ä¸ä»ç½‘ç»œè®¿é—®çš„æ•°æ®å…³è”çš„ LiveData å¯¹è±¡ã€‚</li>
</ul>
</blockquote>
<blockquote>
<p>æ‚¨çš„ Activity åªéœ€è§‚å¯Ÿ MediatorLiveData å¯¹è±¡å³å¯ä»è¿™ä¸¤ä¸ªæºæ¥æ”¶æ›´æ–°ã€‚</p>
</blockquote>
<h3 id="å°èŠ‚"><a href="#å°èŠ‚" class="headerlink" title="å°èŠ‚"></a>å°èŠ‚</h3><p>LiveData æ˜¯ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„æ•°æ®è§‚å¯Ÿè€…ï¼Œä½ å¯ä»¥é€šè¿‡è‡ªå®šä¹‰LiveDataã€ä½¿ç”¨map()åŠswitchMap()è½¬æ¢LiveDataæºä¸ºä½ éœ€è¦çš„LiveDataæºã€ä½ ä¹Ÿå¯ä»¥åˆå¹¶è§‚å¯Ÿä¸åŒçš„LiveDataæºçš„å˜åŒ–ï¼Œè¿™äº›æ–¹å¼åŸºæœ¬èƒ½æ»¡è¶³å¯¹ä¸€èˆ¬æ•°æ®è§‚å¯Ÿçš„éœ€æ±‚ã€‚</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/LiveData/" rel="tag"># LiveData</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/03/08/%E7%99%BD%E8%AF%9D%E8%AF%B4Handler-MessageQueue-Looper/" rel="prev" title="ç™½è¯è¯´Handler-MessageQueue-Looper">
      <i class="fa fa-chevron-left"></i> ç™½è¯è¯´Handler-MessageQueue-Looper
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/04/04/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8B%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96/" rel="next" title="æ€§èƒ½ä¼˜åŒ–ä¹‹å†…å­˜ä¼˜åŒ–">
      æ€§èƒ½ä¼˜åŒ–ä¹‹å†…å­˜ä¼˜åŒ– <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#LiveData%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="nav-number">1.</span> <span class="nav-text">LiveDataçš„ä¼˜åŠ¿</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="nav-number">2.</span> <span class="nav-text">å¼•å…¥ä¾èµ–</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BALiveData"><span class="nav-number">3.</span> <span class="nav-text">åˆ›å»ºLiveData</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%82%E5%AF%9FLiveData"><span class="nav-number">4.</span> <span class="nav-text">è§‚å¯ŸLiveData</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A9%E5%B1%95LiveData"><span class="nav-number">5.</span> <span class="nav-text">æ‰©å±•LiveData</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2-LiveData"><span class="nav-number">6.</span> <span class="nav-text">è½¬æ¢ LiveData</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%88%E5%B9%B6LiveData"><span class="nav-number">7.</span> <span class="nav-text">åˆå¹¶LiveData</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E8%8A%82"><span class="nav-number"></span> <span class="nav-text">å°èŠ‚</span></a></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Tinlone"
      src="/images/favicon-32x32-next.png">
  <p class="site-author-name" itemprop="name">Tinlone</p>
  <div class="site-description" itemprop="description">Tinloneçš„ä¸ªäººåšå®¢</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
	
	<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=16435049&auto=1&height=66"></iframe>
	
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tinlone</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">48k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">44 åˆ†é’Ÿ</span>
</div>
<!--
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>
-->

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>

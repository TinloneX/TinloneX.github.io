<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="https://s3.ax1x.com/2021/02/24/yXYu7R.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-material.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tinlone.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="ç›®å½• ZERO 1. ä½¿ç”¨ç¯‡ 1.1 å£°æ˜ä¾èµ–é¡¹ 1.2 è¯¥å¦‚ä½•ä½¿ç”¨ï¼Ÿ 1.3 WorkRequestç±»å‹ 1.4 ä¸€èˆ¬æ“ä½œ 1.4.1 ä»»åŠ¡ç›‘å¬ 1.4.2 ä¼ é€’æ•°æ® 1.4.3 å¤šä»»åŠ¡ä¸²è” 1.4.4 å”¯ä¸€ä»»åŠ¡ 1.4.5 ä»»åŠ¡çº¦æŸ 1.4.6 ä»»åŠ¡å»¶æ—¶ 1.4.7 é‡è¯•å’Œé€€é¿æ”¿ç­– 1.4.8 æ ‡è®°å·¥ä½œ 1.4.9 å–æ¶ˆå·¥ä½œ   1.5 æ³¨æ„äº‹é¡¹     ZEROQ: ä»€ä¹ˆæ˜¯WorkManag">
<meta property="og:type" content="article">
<meta property="og:title" content="WorkManageråŸºæœ¬ä½¿ç”¨åŠæºç åˆ†æ(ä¸€) - ä½¿ç”¨ç¯‡">
<meta property="og:url" content="http://tinlone.com/2021/02/06/WorkManager%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%8F%8A%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90(%E4%B8%80)%20-%20%E4%BD%BF%E7%94%A8%E7%AF%87/index.html">
<meta property="og:site_name" content="Tinlone">
<meta property="og:description" content="ç›®å½• ZERO 1. ä½¿ç”¨ç¯‡ 1.1 å£°æ˜ä¾èµ–é¡¹ 1.2 è¯¥å¦‚ä½•ä½¿ç”¨ï¼Ÿ 1.3 WorkRequestç±»å‹ 1.4 ä¸€èˆ¬æ“ä½œ 1.4.1 ä»»åŠ¡ç›‘å¬ 1.4.2 ä¼ é€’æ•°æ® 1.4.3 å¤šä»»åŠ¡ä¸²è” 1.4.4 å”¯ä¸€ä»»åŠ¡ 1.4.5 ä»»åŠ¡çº¦æŸ 1.4.6 ä»»åŠ¡å»¶æ—¶ 1.4.7 é‡è¯•å’Œé€€é¿æ”¿ç­– 1.4.8 æ ‡è®°å·¥ä½œ 1.4.9 å–æ¶ˆå·¥ä½œ   1.5 æ³¨æ„äº‹é¡¹     ZEROQ: ä»€ä¹ˆæ˜¯WorkManag">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/TinloneX/WorkManagerDemo/blob/main/images/OneTimeWork_state.png">
<meta property="og:image" content="https://github.com/TinloneX/WorkManagerDemo/blob/main/images/PeriodicWork_state.png">
<meta property="article:published_time" content="2021-02-06T09:07:13.274Z">
<meta property="article:modified_time" content="2021-02-06T09:06:20.856Z">
<meta property="article:author" content="Tinlone">
<meta property="article:tag" content="WorkManager">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/TinloneX/WorkManagerDemo/blob/main/images/OneTimeWork_state.png">

<link rel="canonical" href="http://tinlone.com/2021/02/06/WorkManager%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%8F%8A%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90(%E4%B8%80)%20-%20%E4%BD%BF%E7%94%A8%E7%AF%87/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>WorkManageråŸºæœ¬ä½¿ç”¨åŠæºç åˆ†æ(ä¸€) - ä½¿ç”¨ç¯‡ | Tinlone</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Tinlone</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">å •è½çš„ğŸŸ</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://tinlone.com/2021/02/06/WorkManager%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%8F%8A%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90(%E4%B8%80)%20-%20%E4%BD%BF%E7%94%A8%E7%AF%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://s3.ax1x.com/2021/02/24/yXYu7R.png">
      <meta itemprop="name" content="Tinlone">
      <meta itemprop="description" content="Tinloneçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tinlone">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          WorkManageråŸºæœ¬ä½¿ç”¨åŠæºç åˆ†æ(ä¸€) - ä½¿ç”¨ç¯‡
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-02-06 17:07:13 / ä¿®æ”¹æ—¶é—´ï¼š17:06:20" itemprop="dateCreated datePublished" datetime="2021-02-06T17:07:13+08:00">2021-02-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Jetpack/" itemprop="url" rel="index"><span itemprop="name">Jetpack</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>7.7k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>7 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul>
<li><a href="#zero">ZERO</a></li>
<li><a href="#part_use">1. ä½¿ç”¨ç¯‡</a><ul>
<li><a href="#dependencies">1.1 å£°æ˜ä¾èµ–é¡¹</a></li>
<li><a href="#how_to_use">1.2 è¯¥å¦‚ä½•ä½¿ç”¨ï¼Ÿ</a></li>
<li><a href="#task_type">1.3 WorkRequestç±»å‹</a></li>
<li><a href="#general_operation">1.4 ä¸€èˆ¬æ“ä½œ</a><ul>
<li><a href="#task_listener">1.4.1 ä»»åŠ¡ç›‘å¬</a></li>
<li><a href="#transfer_data">1.4.2 ä¼ é€’æ•°æ®</a></li>
<li><a href="#multiple_ask">1.4.3 å¤šä»»åŠ¡ä¸²è”</a></li>
<li><a href="#UniqueWork">1.4.4 å”¯ä¸€ä»»åŠ¡</a></li>
<li><a href="#task_onstraint">1.4.5 ä»»åŠ¡çº¦æŸ</a></li>
<li><a href="#task_delay">1.4.6 ä»»åŠ¡å»¶æ—¶</a></li>
<li><a href="#retry_rollback">1.4.7 é‡è¯•å’Œé€€é¿æ”¿ç­–</a></li>
<li><a href="#work_tag">1.4.8 æ ‡è®°å·¥ä½œ</a></li>
<li><a href="#work_cancel">1.4.9 å–æ¶ˆå·¥ä½œ</a></li>
</ul>
</li>
<li><a href="#attention">1.5 æ³¨æ„äº‹é¡¹</a></li>
</ul>
</li>
</ul>
<hr>
<h3 id="ZERO"><a href="#ZERO" class="headerlink" title="ZERO"></a><a href="#zero">ZERO</a></h3><p><strong>Q:</strong> ä»€ä¹ˆæ˜¯WorkManagerï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒï¼Ÿ</p>
<blockquote>
<p>WorkManager æ˜¯ä¸€ä¸ª APIï¼Œå¯ä¾›æ‚¨è½»æ¾è°ƒåº¦é‚£äº›å³ä½¿åœ¨é€€å‡ºåº”ç”¨æˆ–é‡å¯è®¾å¤‡åä»åº”è¿è¡Œçš„å¯å»¶æœŸå¼‚æ­¥ä»»åŠ¡ã€‚WorkManager API æ˜¯ä¸€ä¸ªé€‚åˆç”¨æ¥æ›¿æ¢å…ˆå‰çš„ Android åå°è°ƒåº¦ APIï¼ˆåŒ…æ‹¬ FirebaseJobDispatcherã€GcmNetworkManager å’Œ JobSchedulerï¼‰çš„ç»„ä»¶ï¼Œæˆ‘ä»¬ä¹Ÿå»ºè®®æ‚¨è¿™æ ·åšã€‚WorkManager åœ¨å…¶ç°ä»£ã€ä¸€è‡´çš„ API ä¸­æ•´åˆäº†å…¶å‰èº«çš„åŠŸèƒ½ï¼Œè¯¥ API æ”¯æŒ API çº§åˆ« 14ï¼Œåœ¨å¼€å‘æ—¶å³è€ƒè™‘åˆ°äº†å¯¹ç”µæ± ç»­èˆªçš„å½±å“ã€‚</p>
</blockquote>
<p><strong>Q:</strong> ä¸€å®šè¦ä½¿ç”¨WorkManagerå—ï¼Ÿ</p>
<blockquote>
<p>å¦‚æœæ‚¨çš„åº”ç”¨ä»¥ Android 10ï¼ˆAPI çº§åˆ« 29ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬ä¸ºç›®æ ‡å¹³å°ï¼Œé‚£ä¹ˆæ‚¨å¯¹ FirebaseJobDispatcher å’Œ GcmNetworkManager API çš„è°ƒç”¨åœ¨æ­è½½ Android Marshmallow (6.0) åŠæ›´é«˜ç‰ˆæœ¬çš„è®¾å¤‡ä¸Šå°†æ— æ³•æ­£å¸¸å·¥ä½œã€‚</p>
</blockquote>
<p>ç”±ä¸Šä¸€é—®é¢˜å¯çŸ¥ï¼ŒWorkManageræ˜¯å¯¹ FirebaseJobDispatcher å’Œ GcmNetworkManager API çš„æ›¿æ¢ï¼Œåœ¨ä¸€å®šæƒ…å¢ƒä¸‹ï¼Œæ˜¾ç„¶æ›´æ¨èæ‚¨ä½¿ç”¨WorkManagerã€‚</p>
<hr>
<p>æœ¬ç« ä¸»è¦å†…å®¹ä¸ºWorkManageråŸºæœ¬ä½¿ç”¨åŠæºç åˆ†æï¼Œæ¶‰åŠWorkManagerå…¥é—¨ä½¿ç”¨ã€æºç åˆ†æä¸¤ä¸ªéƒ¨åˆ†ï¼Œå¯æ ¹æ®ä¸ªäººéœ€è¦é€‰æ‹©éƒ¨åˆ†å†…å®¹é˜…è¯»ã€‚</p>
<p>æœ¬ç« æ‰€è¿°WorkManagerç›¸å…³å†…å®¹å‡åŸºäº<code>WorkManager:2.4.0</code>;</p>
<p>æœ¬ç« æ¶‰åŠä»£ç å†…å®¹å‡ä½¿ç”¨<strong>Java</strong>è¯­è¨€ç¼–å†™ï¼ŒJavaç‰ˆæœ¬1.8ï¼›</p>
<p><a target="_blank" rel="noopener" href="https://github.com/TinloneX">æœ¬ç« æ¼”ç¤ºé¡¹ç›®åœ°å€ï¼šhttps://github.com/TinloneX</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/workmanager">å‚è€ƒå®˜æ–¹æ–‡æ¡£è¯·ç‚¹å‡»è¿™é‡Œ</a></p>
<a id="more"></a>

<h3 id="1-ä½¿ç”¨ç¯‡"><a href="#1-ä½¿ç”¨ç¯‡" class="headerlink" title=" 1. ä½¿ç”¨ç¯‡"></a><span id="part_use"> 1. ä½¿ç”¨ç¯‡</h3><blockquote>
<p>WorkManager is a library used to enqueue deferrable work that is guaranteed to execute sometime after its Constraints are met. WorkManager allows observation of work status and the ability to create complex chains of work. </p>
</blockquote>
<p>WorkManageræ˜¯ä¸€ä¸ªç”¨äºå°†å¯å»¶è¿Ÿçš„å·¥ä½œæ”¾å…¥é˜Ÿåˆ—çš„åº“ï¼Œè¿™äº›å·¥ä½œä¿è¯åœ¨æ»¡è¶³å…¶çº¦æŸåçš„æŸä¸ªæ—¶é—´å†…æ‰§è¡Œã€‚WorkManagerå…è®¸è§‚å¯Ÿå·¥ä½œçŠ¶æ€ï¼Œå¹¶èƒ½å¤Ÿåˆ›å»ºå¤æ‚çš„å·¥ä½œé“¾ã€‚</p>
<p><strong>æ³¨æ„ï¼šWorkManager éœ€è¦ compileSdk ç‰ˆæœ¬ 28 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</strong></p>
<h4 id="1-1-å£°æ˜ä¾èµ–é¡¹"><a href="#1-1-å£°æ˜ä¾èµ–é¡¹" class="headerlink" title=" 1.1 å£°æ˜ä¾èµ–é¡¹"></a><span id="dependencies"> 1.1 å£°æ˜ä¾èµ–é¡¹</h4><p>å¦‚éœ€æ·»åŠ  WorkManager çš„ä¾èµ–é¡¹ï¼Œæ‚¨å¿…é¡»å°† Google Maven ä»£ç åº“æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼š</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¡¹ç›®æ ¹ç›®å½•ä¸‹build.gradle</span></span><br><span class="line"><span class="keyword">allprojects</span> &#123;</span><br><span class="line">    <span class="keyword">repositories</span> &#123;</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨åº”ç”¨æˆ–æ¨¡å—çš„ build.gradle æ–‡ä»¶ä¸­æ·»åŠ æ‰€éœ€å·¥ä»¶çš„ä¾èµ–é¡¹ï¼š</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/build.gradle</span></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">  <span class="keyword">def</span> work_version = <span class="string">&quot;2.4.0&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// (Java only) å•çº¯ä½¿ç”¨javaå¯å¼•ç”¨æ­¤ä¾èµ–</span></span><br><span class="line">    implementation <span class="string">&quot;androidx.work:work-runtime:$work_version&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Kotlin + coroutines ä½¿ç”¨kotlin+åç¨‹å¯å¼•ç”¨æ­¤ä¾èµ–</span></span><br><span class="line">    implementation <span class="string">&quot;androidx.work:work-runtime-ktx:$work_version&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// optional - RxJava2 support æ„å›¾æ”¯æŒRxJava2çš„WorkManagerå¯å¼•ç”¨æ­¤ä¾èµ–</span></span><br><span class="line">    implementation <span class="string">&quot;androidx.work:work-rxjava2:$work_version&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// optional - GCMNetworkManager support   @â‘ </span></span><br><span class="line">    implementation <span class="string">&quot;androidx.work:work-gcm:$work_version&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// optional - Test helpers  æµ‹è¯•å·¥ä»¶</span></span><br><span class="line">    androidTestImplementation <span class="string">&quot;androidx.work:work-testing:$work_version&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>ä»¥ä¸Šä¾èµ–å‡åªéœ€å¼•ç”¨ä¸€ä¸ªå³å¯ï¼Œæ­¤æ–‡æ¡£åŠä»£ç å‡ä½¿ç”¨<code>androidx.work:work-runtime:2.4.0</code>ã€‚</li>
<li>ç‰¹åˆ«çš„ï¼Œâ‘  <blockquote>
<p>androidx.work:work-gcm:2.2.0 æ˜¯ä¸€ä¸ªæ–°çš„ Maven å·¥ä»¶ï¼Œå½“ Google Play æœåŠ¡å¯ç”¨äº API çº§åˆ« 22 æˆ–æ›´ä½çº§åˆ«æ—¶ï¼Œè¯¥å·¥ä»¶æ”¯æŒå°† GCMNetworkManager ç”¨ä½œè°ƒåº¦ç¨‹åºã€‚è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„ä¾èµ–é¡¹ï¼Œæœ‰åŠ©äºåœ¨è¾ƒæ—§çš„ API ç‰ˆæœ¬ä¸Šè¿›è¡Œæ›´ç¨³å®šä¸”æ€§èƒ½æ›´é«˜çš„åå°å¤„ç†å·¥ä½œã€‚å¦‚æœæ‚¨çš„åº”ç”¨ä½¿ç”¨ Google Play æœåŠ¡ï¼Œè¯·å°†æ­¤ä¾èµ–é¡¹æ·»åŠ åˆ° gradle æ–‡ä»¶ï¼Œä»¥è‡ªåŠ¨è·å¾— GCMNetworkManager æ”¯æŒã€‚å¦‚æœ Play æœåŠ¡ä¸å¯ç”¨ï¼ŒWorkManager å°†ç»§ç»­åœ¨æ—§æ¬¾è®¾å¤‡ä¸Šå›é€€åˆ° AlarmManagerã€‚</p>
</blockquote>
</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬å°†æ­£å¼è¿›å…¥WorkManagerä½¿ç”¨ç¯‡</p>
<h4 id="1-2-è¯¥å¦‚ä½•ä½¿ç”¨"><a href="#1-2-è¯¥å¦‚ä½•ä½¿ç”¨" class="headerlink" title=" 1.2 è¯¥å¦‚ä½•ä½¿ç”¨"></a><span id="how_to_use"> 1.2 è¯¥å¦‚ä½•ä½¿ç”¨</h4><p>åœ¨è®²è§£ä»»åŠ¡ç±»å‹åŠå…¶ä¸€èˆ¬ä½¿ç”¨å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£WorkManagerå·¥ä½œçš„æµç¨‹ï¼š</p>
<ul>
<li><strong>è°æ¥åš</strong> å®šä¹‰ä¸€ä¸ªè´Ÿè´£å·¥ä½œçš„<strong>Worker</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class SimpleWorker extends Worker &#123;</span><br><span class="line">@NonNull</span><br><span class="line">    @Override</span><br><span class="line">    public Result doWork() &#123;</span><br><span class="line">        &#x2F;&#x2F; return Result.failure(); &#x2F;&#x2F; æ‰§è¡Œå¤±è´¥</span><br><span class="line">        &#x2F;&#x2F; return Result.retry();   &#x2F;&#x2F; é‡è¯• </span><br><span class="line">        &#x2F;&#x2F; return Result.success(); &#x2F;&#x2F; æ‰§è¡ŒæˆåŠŸ</span><br><span class="line">        return null;                &#x2F;&#x2F; æ‰§è¡Œç»“æŸï¼Ÿ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
Workeræ˜¯WorkManageræœ€ç»ˆå®ç°ä»»åŠ¡çš„â€œå·¥äººâ€ï¼Œå®ƒä¸ç”¨ç®¡ä¼šåœ¨ä»€ä¹ˆå®é™…æ‰§è¡Œä»»åŠ¡ï¼Œè¢«å®‰æ’æ€æ ·æ‰§è¡Œä»»åŠ¡ï¼Œåªç®¡åŸ‹å¤´å¤„ç†ä»»åŠ¡<code>doWork</code>å¹¶æ ¹æ®ä»»åŠ¡æ‰§è¡Œæƒ…å†µåé¦ˆä»»åŠ¡ç»“æœ<code>return Result</code>ã€‚</li>
</ul>
<p>Workeræ‰§è¡Œç»“æœResultï¼šè¡¨ç¤ºä»»åŠ¡çŠ¶æ€ï¼Œä»–ä¸€èˆ¬æœ‰<code>failure</code>ã€<code>retry</code>ã€<code>success</code>ä¸‰ä¸ªçŠ¶æ€ï¼Œä¸”<code>failure</code>ã€<code>success</code>å¯ä»¥æºå¸¦æ•°æ®<code>Data</code>ï¼Œæ­¤å¤„ä»…åšäº†è§£ï¼Œ<a href="#periodic_task">ä¼ é€’æ•°æ®</a>ä¸­å°†åšå…·ä½“è¯´æ˜ã€‚</p>
<ul>
<li><strong>æ€ä¹ˆåš</strong> å®šä¹‰åˆ¶å®šå·¥ä½œæ–¹æ¡ˆçš„<strong>WorkRequest</strong></li>
</ul>
<ol>
<li><strong>éé‡å¤æ€§å·¥ä½œï¼š</strong> å·¥äººåº”è¯¥ä¸€æ¬¡æ€§æŠŠå·¥ä½œåšæ‰<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OneTimeWorkRequest workRequest1 = OneTimeWorkRequest.from(SimpleWorker.class);</span><br></pre></td></tr></table></figure></li>
<li><strong>å‘¨æœŸä»»åŠ¡ï¼š</strong> å·¥äººåº”è¯¥æ¯éš”å¤šä¹…åšä¸€æ¬¡å·¥ä½œ</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PeriodicWorkRequest request &#x3D; new PeriodicWorkRequest</span><br><span class="line">               .Builder(SimpleWorker.class, 16, TimeUnit.MINUTES).build();</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼š</strong> å…³äºå‘¨æœŸä»»åŠ¡æœ‰ä¸€ä¸ª<strong>éœ¸ç‹æ¡æ¬¾ï¼š</strong></p>
<blockquote>
<p>æ³¨æ„ï¼šå¯ä»¥å®šä¹‰çš„æœ€çŸ­é‡å¤é—´éš”æ˜¯ 15 åˆ†é’Ÿï¼ˆä¸ JobScheduler API ç›¸åŒï¼‰ã€‚</p>
</blockquote>
<blockquote>
<p>å¦‚æœæ‚¨çš„å·¥ä½œçš„æ€§è´¨è‡´ä½¿å…¶å¯¹è¿è¡Œæ—¶é—´æ•æ„Ÿï¼Œæ‚¨å¯ä»¥å°† PeriodicWorkRequest é…ç½®ä¸ºåœ¨æ¯ä¸ªæ—¶é—´é—´éš”çš„çµæ´»æ—¶é—´æ®µå†…è¿è¡Œã€‚</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/workmanager/how-to/define-work#flexible_run_intervals">ç‚¹æ­¤è·å–â€œçµæ´»çš„è¿è¡Œé—´éš”â€è¯´æ˜</a></p>
<ul>
<li><strong>è°æ¥ç®¡</strong> å·¥ä½œæ–¹æ¡ˆè°æ¥å®¡æ‰¹è°æ¥ç®¡ç†<strong>WorkManager</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WorkManager.getInstance(myContext).enqueue(myWorkRequest);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è‡ªæ­¤ï¼Œé€šè¿‡Worker + WorkRequest + WorkManagerå°±å¯ä»¥å®Œæˆä¸€æ¬¡æœ€ç®€å·¥ä½œçš„è°ƒç”¨æµç¨‹ï¼Œå…¶ä¸­<strong>Workeræ‰§è¡Œå·¥ä½œï¼ŒWorkRequestå°è£…å·¥ä½œï¼ŒWorkManagerç®¡ç†å·¥ä½œ</strong>ã€‚</p>
<h4 id="1-3-WorkRequestç±»å‹"><a href="#1-3-WorkRequestç±»å‹" class="headerlink" title=" 1.3 WorkRequestç±»å‹"></a><span id="task_type"> 1.3 WorkRequestç±»å‹</h4><p>WorkRequest ç›®å‰æœ‰ä¸¤ä¸ªå­ç±»ï¼Œåˆ†åˆ«ä¸ºå•æ¬¡æ‰§è¡Œä»»åŠ¡ <code>OneTimeWorkRequest</code>å’Œå‘¨æœŸæ‰§è¡Œä»»åŠ¡ <code>PeriodicWorkRequest</code>. ä»–ä»¬çš„ä¸»è¦åŒºåˆ«æ˜¯ä»»åŠ¡æ‰§è¡Œæ–¹æ¡ˆä¸åŒå¯¼è‡´çš„çŠ¶æ€å˜åŒ–ä¸åŒã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/TinloneX/WorkManagerDemo/blob/main/images/OneTimeWork_state.png">ç®€å•å•æ¬¡æ‰§è¡Œä»»åŠ¡ OneTimeWorkRequest å·¥ä½œçŠ¶æ€å›¾</a>ï¼š</p>
<p><img src="https://github.com/TinloneX/WorkManagerDemo/blob/main/images/OneTimeWork_state.png" alt="OneTimeWork_STATE"></p>
<blockquote>
<p>å¯¹äº one-time å·¥ä½œè¯·æ±‚ï¼Œå·¥ä½œçš„åˆå§‹çŠ¶æ€ä¸º ENQUEUEDã€‚</p>
</blockquote>
<blockquote>
<p>åœ¨ ENQUEUED çŠ¶æ€ä¸‹ï¼Œæ‚¨çš„å·¥ä½œä¼šåœ¨æ»¡è¶³å…¶ Constraints å’Œåˆå§‹å»¶è¿Ÿè®¡æ—¶è¦æ±‚åç«‹å³è¿è¡Œã€‚æ¥ä¸‹æ¥ï¼Œè¯¥å·¥ä½œä¼šè½¬ä¸º RUNNING çŠ¶æ€ï¼Œç„¶åå¯èƒ½ä¼šæ ¹æ®å·¥ä½œçš„ç»“æœè½¬ä¸º SUCCEEDEDã€FAILED çŠ¶æ€ï¼›æˆ–è€…ï¼Œå¦‚æœç»“æœæ˜¯ retryï¼Œå®ƒå¯èƒ½ä¼šå›åˆ° ENQUEUED çŠ¶æ€ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œéšæ—¶éƒ½å¯ä»¥å–æ¶ˆå·¥ä½œï¼Œå–æ¶ˆåå·¥ä½œå°†è¿›å…¥ CANCELLED çŠ¶æ€ã€‚</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/TinloneX/WorkManagerDemo/blob/main/images/PeriodicWork_state.png">å‘¨æœŸæ‰§è¡Œä»»åŠ¡ PeriodicWorkRequest å·¥ä½œçŠ¶æ€å›¾</a>ï¼š</p>
<p><img src="https://github.com/TinloneX/WorkManagerDemo/blob/main/images/PeriodicWork_state.png" alt="PeriodicWork_STATE"></p>
<p>å‘¨æœŸæ€§å·¥ä½œçš„åˆå§‹çŠ¶æ€ä¸º ENQUEUEDï¼Œæ­£å¸¸æ‰§è¡Œæƒ…å†µä¸‹ï¼Œå‘¨æœŸæ€§å·¥ä½œçš„çŠ¶æ€åœ¨ENQUEUED â†”RUNNINGä¹‹é—´äº¤æ›¿ï¼ŒçŸ¥é“ä»»åŠ¡è¢«å–æ¶ˆæ—¶ï¼ŒçŠ¶æ€ä¸ºCANCELLEDã€‚</p>
<blockquote>
<p>æˆåŠŸå’Œå¤±è´¥çŠ¶æ€ä»…é€‚ç”¨äºä¸€æ¬¡æ€§å·¥ä½œå’Œé“¾å¼å·¥ä½œã€‚å®šæœŸå·¥ä½œåªæœ‰ä¸€ä¸ªç»ˆæ­¢çŠ¶æ€ CANCELLEDã€‚è¿™æ˜¯å› ä¸ºå®šæœŸå·¥ä½œæ°¸è¿œä¸ä¼šç»“æŸã€‚æ¯æ¬¡è¿è¡Œåï¼Œæ— è®ºç»“æœå¦‚ä½•ï¼Œç³»ç»Ÿéƒ½ä¼šé‡æ–°å¯¹å…¶è¿›è¡Œè°ƒåº¦ã€‚</p>
</blockquote>
<p>è‹¥å·¥ä½œçŠ¶æ€å›¾æ— æ³•å±•ç¤ºï¼Œå‚è§<a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/workmanager/how-to/states-and-observation">Android-Developers/WorkManager</a>ã€‚</p>
<h4 id="1-4-ä¸€èˆ¬æ“ä½œ"><a href="#1-4-ä¸€èˆ¬æ“ä½œ" class="headerlink" title=" 1.4 ä¸€èˆ¬æ“ä½œ"></a><span id="general_operation"> 1.4 ä¸€èˆ¬æ“ä½œ</h4><p>ä¸Š<a href="#how_to_use">1.2</a>ä¸­ï¼Œæè¿°äº†æœ€ç®€å·¥ä½œçš„ç¼–å†™ï¼Œé‚£ä¹ˆé™¤äº†è¿™äº›åŸºæœ¬çš„<strong>è°æ¥åš</strong>ã€<strong>æ€ä¹ˆåš</strong>ã€<strong>è°æ¥ç®¡</strong>å¤–ï¼ŒWorkManagerè¿˜æœ‰å“ªäº›å¯ä»¥æ“ä½œçš„ç‚¹å‘¢ï¼Ÿ</p>
<p><strong><span id="task_listener">1.4.1 ä»»åŠ¡ç›‘å¬</strong> ï¼ˆæ€ä¹ˆå…³æ³¨ä»»åŠ¡è¿›åº¦ï¼‰</p>
<p>ä¸Šé¢<a href="#task_type">1.3</a>ä¸­ä»‹ç»äº†çš„çŠ¶æ€ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ç›‘å¬è¿™äº›çŠ¶æ€å‘¢ï¼Ÿ</p>
<p>æ–¹å¼1 ï¼š</p>
<p><em>æ³¨ï¼šæœ¬æ–‡åŠæ¡ˆä¾‹æœªè¯¦å°½çš„å®è·µæ­¤æ–¹å¼, æ­¤å°èŠ‚å†…å®¹å‡æ¥è‡ª<a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/workmanager/how-to/managing-work#observing">å®˜æ–¹æ–‡æ¡£</a></em></p>
<blockquote>
<p>åœ¨å°†å·¥ä½œåŠ å…¥é˜Ÿåˆ—åï¼Œæ‚¨å¯ä»¥éšæ—¶æŒ‰å…¶ nameã€id æˆ–ä¸å…¶å…³è”çš„ tag åœ¨ WorkManager ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œä»¥æ£€æŸ¥å…¶çŠ¶æ€</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; by id</span><br><span class="line">workManager.getWorkInfoById(syncWorker.id); &#x2F;&#x2F; ListenableFuture&lt;WorkInfo&gt;</span><br><span class="line">&#x2F;&#x2F; by name</span><br><span class="line">workManager.getWorkInfosForUniqueWork(&quot;sync&quot;); &#x2F;&#x2F; ListenableFuture&lt;List&lt;WorkInfo&gt;&gt;</span><br><span class="line">&#x2F;&#x2F; by tag</span><br><span class="line">workManager.getWorkInfosByTag(&quot;syncTag&quot;); &#x2F;&#x2F; ListenableFuture&lt;List&lt;WorkInfo&gt;&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; æ­¤å¤„å°è¯•ä½¿ç”¨æ­¤æ–¹å¼ç›‘å¬ï¼Œå¯ç›‘å¬åˆ°éƒ¨åˆ†çŠ¶æ€</span><br><span class="line">WorkManager.getInstance(this).getWorkInfoById(workRequest.getId()).addListener(() -&gt; Utils.log(future), Runnable::run);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¯¥æŸ¥è¯¢ä¼šè¿”å› WorkInfo å¯¹è±¡çš„ ListenableFutureï¼Œè¯¥å€¼åŒ…å«å·¥ä½œçš„ idã€å…¶æ ‡è®°ã€å…¶å½“å‰çš„ State ä»¥åŠé€šè¿‡ Result.success(outputData) è®¾ç½®çš„ä»»ä½•è¾“å‡ºæ•°æ®ã€‚</p>
</blockquote>
<p>æ–¹å¼2ï¼š</p>
<blockquote>
<p>åˆ©ç”¨æ¯ä¸ªæ–¹æ³•çš„ LiveData å˜ç§ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ³¨å†Œç›‘å¬å™¨æ¥è§‚å¯Ÿ WorkInfo çš„å˜åŒ–ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">WorkManager.getInstance(context)</span><br><span class="line">            .getWorkInfoByIdLiveData(workRequest.getId())</span><br><span class="line">            .observe(lifecycleOwner, new Observer&lt;WorkInfo&gt;() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void onChanged(WorkInfo workInfo) &#123;</span><br><span class="line">                    &#x2F;&#x2F; workInfo.getState() å¯è·å–ä»»åŠ¡çŠ¶æ€</span><br><span class="line">                    Utils.log(workInfo.getState());</span><br><span class="line">                    &#x2F;&#x2F; workInfo.getOutputData() å¯è·å–ä»»åŠ¡ä¼ é€’çš„æ•°æ®ï¼ˆè¯¦è§1.4.2ï¼‰</span><br><span class="line">                    if (workInfo.getState().isFinished()) &#123;</span><br><span class="line">                        Utils.log(workInfo.getOutputData());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br></pre></td></tr></table></figure>
<p>å¤æ‚çš„å·¥ä½œæŸ¥è¯¢ï¼š</p>
<p> <em><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/workmanager/how-to/managing-work#complex-queries">å®˜æ–¹æ–‡æ¡£</a></em></p>
<blockquote>
<p>WorkManager 2.4.0 åŠæ›´é«˜ç‰ˆæœ¬æ”¯æŒä½¿ç”¨ WorkQuery å¯¹è±¡å¯¹å·²åŠ å…¥é˜Ÿåˆ—çš„ä½œä¸šè¿›è¡Œå¤æ‚æŸ¥è¯¢ã€‚WorkQuery æ”¯æŒæŒ‰å·¥ä½œçš„æ ‡è®°ã€çŠ¶æ€å’Œå”¯ä¸€å·¥ä½œåç§°çš„ç»„åˆè¿›è¡ŒæŸ¥è¯¢ã€‚</p>
</blockquote>
<blockquote>
<p>ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜äº†å¦‚ä½•æŸ¥æ‰¾å¸¦æœ‰â€œsyncTagâ€æ ‡è®°ã€å¤„äº FAILED æˆ– CANCELLED çŠ¶æ€ï¼Œä¸”å”¯ä¸€å·¥ä½œåç§°ä¸ºâ€œpreProcessâ€æˆ–â€œsyncâ€çš„æ‰€æœ‰å·¥ä½œã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">WorkQuery workQuery = WorkQuery.Builder</span><br><span class="line">       .fromTags(Arrays.asList(<span class="string">&quot;syncTag&quot;</span>))</span><br><span class="line">       .addStates(Arrays.asList(WorkInfo.State.FAILED, WorkInfo.State.CANCELLED))</span><br><span class="line">       .addUniqueWorkNames(Arrays.asList(<span class="string">&quot;preProcess&quot;</span>, <span class="string">&quot;sync&quot;</span>)</span><br><span class="line">     )</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">ListenableFuture&lt;List&lt;WorkInfo&gt;&gt; workInfos = workManager.getWorkInfos(workQuery);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šç»å®è·µï¼Œæ­¤æ–¹æ³•è·å–çš„æ˜¯<code>workManager.getWorkInfos(workQuery)</code>è°ƒç”¨æ—¶ä»»åŠ¡çš„çŠ¶æ€ï¼Œè‹¥æƒ³ä½¿ç”¨æ­¤æ–¹æ³•æŒç»­è§‚å¯Ÿä»»åŠ¡çŠ¶æ€ï¼Œå»ºè®®ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ­¤å¤„åº”å°†Utils.executor()è§†ä½œ ThreadPoolExecutor</span></span><br><span class="line">Utils.executor().execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                    ListenableFuture&lt;List&lt;WorkInfo&gt;&gt; workInfos = WorkManager.getInstance(MainActivity.<span class="keyword">this</span>)</span><br><span class="line">                            .getWorkInfos(workQuery);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        List&lt;WorkInfo&gt; infos = workInfos.get();</span><br><span class="line">                        Utils.log(infos);</span><br><span class="line">                        <span class="keyword">for</span> (WorkInfo info : infos) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (info.getState() == WorkInfo.State.SUCCEEDED ||</span><br><span class="line">                                    info.getState() == WorkInfo.State.CANCELLED) &#123;</span><br><span class="line">                                <span class="keyword">return</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        Thread.sleep(<span class="number">1000L</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        Utils.log(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>é™„ï¼šå¦‚éœ€äº†è§£<strong>å¦‚ä½•è§‚å¯Ÿå·¥ä½œå™¨çš„ä¸­é—´è¿›åº¦</strong>ï¼Œå¯<a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/workmanager/how-to/intermediate-progress#observing_progress">ç‚¹å‡»æ­¤å¤„æŸ¥çœ‹</a></p>
<p>ç‰¹åˆ«çš„ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©AndroidStudioçœ‹æ¿è§‚å¯ŸWorkManagerçŠ¶æ€ã€‚</p>
<ul>
<li>AndroidStudioç™½ç‹ä¹‹å‰çš„ç‰ˆæœ¬å¯ä½¿ç”¨DataBase Inspector è§‚å¯Ÿ androidx.work.workdbæ•°æ®åº“ä¸­WorkSpecè¡¨è·å–WorkRequestä¿¡æ¯ï¼›</li>
<li>AndroidStudioç™½ç‹ç‰ˆåˆ™å¯ç›´æ¥ä½¿ç”¨WorkManager InspectoræŸ¥çœ‹WorkRequestä¿¡æ¯ã€‚</li>
</ul>
<p><strong><span id="transfer_data">1.4.2 ä¼ é€’æ•°æ®</strong></p>
<p>åœ¨ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å‘ä»»åŠ¡ä¸­ä¼ é€’æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨<code>androidx.work.Data</code>å‘WorkRequestä¸­æ·»åŠ æ•°æ®ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; åˆ›å»ºéœ€ä¼ é€’çš„æ•°æ®</span><br><span class="line">Data data &#x3D; new Data.Builder().putString(&quot;message&quot;, &quot;MainActivity&quot;).build();</span><br><span class="line">&#x2F;&#x2F; å•æ¬¡æ‰§è¡Œä»»åŠ¡</span><br><span class="line">OneTimeWorkRequest request1 &#x3D; new OneTimeWorkRequest.Builder(Task4DataWorker.class)</span><br><span class="line">        &#x2F;&#x2F; å‘WorkRequestä¸­æ·»åŠ æ•°æ®</span><br><span class="line">        .setInputData(data).build();</span><br><span class="line">&#x2F;&#x2F; å°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—</span><br><span class="line">WorkManager.getInstance(this).enqueue(request1);</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±Dataæºç å¯çŸ¥ï¼Œæ­¤å¤„ä¼ é€’æ•°æ®ä»…æ”¯æŒåŸºç¡€æ•°æ®ç±»å‹åŠå…¶å°è£…ã€Stringä»¥åŠä¸Šè¿°ç±»å‹çš„æ•°ç»„ï¼š</p>
<blockquote>
<p>Puts an input key-value pair into the Builder. Valid types are: Boolean, Integer,  Long, Float, Double, String, and array versions of each of those types. Invalid types throw an {@link IllegalArgumentException}.</p>
</blockquote>
<p><em>å½“ç„¶çš„ï¼Œæœ‰æ²¡æœ‰æƒ³ä½¿ç”¨åå°„å‘Dataä¸­çš„mValuesæ³¨å…¥å…¶ä»–ç±»å‹å‘¢ï¼Ÿ<code>Map<String, Object> mValues = new HashMap<>();</code>, æœŸå¾…ä½ çš„å°è¯•ï¼</em></p>
<p>æœ‰ä¼ é€’æ•°æ®è‡ªç„¶æœ‰è·å–æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥Workerä¸­é€šè¿‡<code>getInputData()</code>è·å–<br>ä¼ å…¥çš„Dataå¯¹è±¡ï¼Œé€šè¿‡Dataè·å–ä¼ å…¥çš„å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Dataå’ŒResultå°†å€¼ä¼ é€’ç»™è§‚å¯Ÿè€…ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class Task4DataWorker extends Worker &#123;</span><br><span class="line"></span><br><span class="line">    public Task4DataWorker(@NonNull Context context, @NonNull WorkerParameters workerParams) &#123;</span><br><span class="line">        super(context, workerParams);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @SuppressLint(&quot;RestrictedApi&quot;)</span><br><span class="line">    @NonNull</span><br><span class="line">    @Override</span><br><span class="line">    public Result doWork() &#123;</span><br><span class="line">        String message &#x3D; getInputData().getString(&quot;message&quot;);</span><br><span class="line">        Data myMsg &#x3D; new Data.Builder().putString(&quot;message&quot;, &quot;message from Worker&quot;).build();</span><br><span class="line">        return new Result.Success(myMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œä»Workerä¸­ä¼ å‡ºçš„Dataåˆ™å¯åœ¨WorkRequestçš„å·¥ä½œçŠ¶æ€WorkInfoä¸­å–å¾—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">WorkManager.getInstance(context)</span><br><span class="line">               .getWorkInfoByIdLiveData(workRequest.getId())</span><br><span class="line">               .observe(context, workInfo -&gt; &#123;</span><br><span class="line">                   if (workInfo!&#x3D;null)&#123;</span><br><span class="line">                       if (workInfo.getState().isFinished()) &#123;</span><br><span class="line">                           String message &#x3D; workInfo.getOutputData().getString(&quot;message&quot;);</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;);</span><br></pre></td></tr></table></figure>
<p><strong><span id="multiple_ask">1.4.3 å¤šä»»åŠ¡ä¸²è”</strong></p>
<p>é™¤ä¸€èˆ¬çš„å•ä¸€ä»»åŠ¡çš„åœºæ™¯å¤–ï¼Œæˆ‘ä»¬é¢å¯¹çš„ä¸šåŠ¡å¾€å¾€ä¹Ÿè¦å¤„ç†å¤šä¸ªä»»åŠ¡çš„åœºæ™¯ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä¸²è”å¤šä¸ªä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥å°†å¤šä¸ªä»»åŠ¡ç¼–ç»„æˆä»»åŠ¡é“¾å»ä½¿ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">WorkManager.getInstance(this).beginWith(workRequest2)</span><br><span class="line">                .then(workRequest3)</span><br><span class="line">                .then(workRequest4)</span><br><span class="line">                .enqueue();</span><br><span class="line">&#x2F;&#x2F; or</span><br><span class="line">WorkContinuation continuation &#x3D; WorkManager.getInstance(this)</span><br><span class="line">                .beginWith(workRequest2)</span><br><span class="line">                .then(workRequest3)</span><br><span class="line">                .then(workRequest4);</span><br><span class="line"></span><br><span class="line">continuation.then(workRequest).enqueue();</span><br></pre></td></tr></table></figure>
<p>ç‰¹åˆ«çš„ï¼Œå¦‚éœ€äº†è§£<strong>ä»»åŠ¡é“¾çš„é«˜çº§ç”¨æ³•åŠåˆå¹¶å™¨</strong>ç›¸å…³å†…å®¹ï¼Œ<a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/workmanager/how-to/chain-work#input-mergers">è¯·ç‚¹å‡»æ­¤å¤„æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£</a>ï¼Œå…¶ä¸­å…³äº<a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/workmanager/how-to/chain-work#work-statuses">é“¾æ¥å’Œå·¥ä½œçŠ¶æ€</a>çš„è¯´æ˜å›¾æ–‡å¹¶èŒ‚ï¼Œæ›´æ˜“äºç†è§£ã€‚</p>
<p><strong><span id="UniqueWork">1.4.4 å”¯ä¸€ä»»åŠ¡</strong></p>
<blockquote>
<p>å”¯ä¸€å·¥ä½œæ˜¯ä¸€ä¸ªå¾ˆå®ç”¨çš„æ¦‚å¿µï¼Œå¯ç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªå…·æœ‰ç‰¹å®šåç§°çš„å·¥ä½œå®ä¾‹ã€‚ä¸ ID ä¸åŒçš„æ˜¯ï¼Œå”¯ä¸€åç§°æ˜¯äººç±»å¯è¯»çš„ï¼Œç”±å¼€å‘è€…æŒ‡å®šï¼Œè€Œä¸æ˜¯ç”± WorkManager è‡ªåŠ¨ç”Ÿæˆã€‚ä¸æ ‡è®°ä¸åŒï¼Œå”¯ä¸€åç§°ä»…ä¸ä¸€ä¸ªå·¥ä½œå®ä¾‹ç›¸å…³è”ã€‚</p>
</blockquote>
<blockquote>
<p>å”¯ä¸€å·¥ä½œæ—¢å¯ç”¨äºä¸€æ¬¡æ€§å·¥ä½œï¼Œä¹Ÿå¯ç”¨äºå®šæœŸå·¥ä½œã€‚æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨ä»¥ä¸‹æ–¹æ³•ä¹‹ä¸€åˆ›å»ºå”¯ä¸€å·¥ä½œåºåˆ—ï¼Œå…·ä½“å–å†³äºæ‚¨æ˜¯è°ƒåº¦é‡å¤å·¥ä½œè¿˜æ˜¯ä¸€æ¬¡æ€§å·¥ä½œã€‚WorkManager.enqueueUniqueWork()ï¼ˆç”¨äºä¸€æ¬¡æ€§å·¥ä½œï¼‰<br>    WorkManager.enqueueUniquePeriodicWork()ï¼ˆç”¨äºå®šæœŸå·¥ä½œï¼‰</p>
</blockquote>
<p>è¿™ä¸¤ç§æ–¹æ³•éƒ½æ¥å— 3 ä¸ªå‚æ•°ï¼š</p>
<pre><code>uniqueWorkName - ç”¨äºå”¯ä¸€æ ‡è¯†å·¥ä½œè¯·æ±‚çš„ Stringã€‚
existingWorkPolicy - æ­¤ enum å¯å‘ŠçŸ¥ WorkManagerï¼šå¦‚æœå·²æœ‰ä½¿ç”¨è¯¥åç§°ä¸”å°šæœªå®Œæˆçš„å”¯ä¸€å·¥ä½œé“¾ï¼Œåº”æ‰§è¡Œä»€ä¹ˆæ“ä½œã€‚å¦‚éœ€äº†è§£è¯¦æƒ…ï¼Œè¯·å‚é˜…å†²çªè§£å†³æ”¿ç­–ã€‚
work - è¦è°ƒåº¦çš„ WorkRequestã€‚
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">OneTimeWorkRequest workRequest &#x3D; new OneTimeWorkRequest.Builder(SimpleWorker2.class).build();</span><br><span class="line">OneTimeWorkRequest workRequest2 &#x3D; new OneTimeWorkRequest.Builder(SimpleWorker2.class).build();</span><br><span class="line"></span><br><span class="line">WorkManager.getInstance(this).beginUniqueWork(&quot;SimpleWorker&quot;,</span><br><span class="line">        ExistingWorkPolicy.REPLACE, workRequest)</span><br><span class="line">&#x2F;&#x2F;      ExistingWorkPolicy.APPEND, workRequest)</span><br><span class="line">&#x2F;&#x2F;      ExistingWorkPolicy.KEEP, workRequest)</span><br><span class="line">        .then(workRequest2)</span><br><span class="line">&#x2F;&#x2F;      .then(workRequest)</span><br><span class="line">        .enqueue();</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„å®šä¹‰çš„å”¯ä¸€ï¼Œä»…åœ¨ä»»åŠ¡æ­£åœ¨æ‰§è¡Œä¸”å‡ºç°ç›¸åŒ<code>uniqueWorkName</code>åç§°æ—¶ï¼ŒexistingWorkPolicyæ‰ç”Ÿæ•ˆï¼Œæ— æ³•å½±å“å·²ç»“æŸçš„åŒåä»»åŠ¡ï¼ˆæ­¤åŒåä»…ä¸uniqueWorkNameæœ‰å…³ï¼‰ã€‚<br>ä»¥å®šä¹‰ä¸¤ä¸ªç›¸åŒ<code>uniqueWorkName</code>çš„WorkRequestä¸ºä¾‹ï¼Œæ¥è§‚å¯ŸexistingWorkPolicyå€¼çš„ä½œç”¨åŠå½±å“ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; è‹¥å‘ç°åä¸ºâ€œSimpleWorkerâ€çš„ä»»åŠ¡ï¼Œåˆ™ä½¿ç”¨æ­¤é“¾æ›¿æ¢ç›®æ ‡åç»­æ“ä½œ</span><br><span class="line">&#x2F;&#x2F; ä»»åŠ¡é“¾ A</span><br><span class="line">WorkManager.getInstance(this).beginUniqueWork(&quot;SimpleWorker&quot;,</span><br><span class="line">        ExistingWorkPolicy.REPLACE, workRequest)</span><br><span class="line">        .then(request3)</span><br><span class="line">        .enqueue();</span><br><span class="line">&#x2F;&#x2F; è‹¥å‘ç°åä¸ºâ€œSimpleWorkerâ€çš„ä»»åŠ¡ï¼Œåˆ™ä¿ç•™ç›®æ ‡çš„åŸæ“ä½œï¼Œæ­¤é“¾ä¸æ‰§è¡Œ</span><br><span class="line">&#x2F;&#x2F; ä»»åŠ¡é“¾ B</span><br><span class="line">WorkManager.getInstance(this).beginUniqueWork(&quot;SimpleWorker&quot;,</span><br><span class="line">        ExistingWorkPolicy.KEEP, workRequest5)</span><br><span class="line">        .then(request2)</span><br><span class="line">        .enqueue();</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä¸¤ä¸ªä»»åŠ¡é“¾ï¼Œè‹¥å…ˆæ‰§è¡ŒAå†æ‰§è¡ŒBï¼Œæ­¤æ—¶æ•ˆæœä¸ºï¼š</p>
<pre><code>workUnique2 start   // ä»»åŠ¡é“¾Aè§¦å‘
workUnique2 end     // ä»»åŠ¡é“¾Aè§¦å‘å®Œæ¯•
doWork start: SimpleWorker  // ä»»åŠ¡é“¾Aè€—æ—¶ä»»åŠ¡workRequestå¼€å§‹æ‰§è¡Œ
workUnique start    // ä»»åŠ¡é“¾Bè§¦å‘
workUnique end      // ä»»åŠ¡é“¾Bè§¦å‘å®Œæ¯•
doWork end: SimpleWorker // ä»»åŠ¡é“¾Aè€—æ—¶ä»»åŠ¡workRequestæ‰§è¡Œå®Œæ¯•
doWork: SimpleWorker3   // ä»»åŠ¡é“¾Aæ‰§è¡Œåç»­ä»»åŠ¡request3
ä»»åŠ¡é“¾Bå¹¶æœªæ‰§è¡Œ
</code></pre>
<p>ä¸Šè¿°ä¸¤ä¸ªä»»åŠ¡é“¾ï¼Œè‹¥å…ˆæ‰§è¡ŒBå†æ‰§è¡ŒAï¼Œæ­¤æ—¶æ•ˆæœä¸ºï¼š</p>
<pre><code>workUnique start    // ä»»åŠ¡é“¾Bè§¦å‘
workUnique end      // ä»»åŠ¡é“¾Bè§¦å‘å®Œæ¯•
doWork start: SimpleWorker5 // ä»»åŠ¡é“¾Bè€—æ—¶ä»»åŠ¡workRequest5å¼€å§‹æ‰§è¡Œ
workUnique2 start   // ä»»åŠ¡é“¾Aè§¦å‘
workUnique2 end     // ä»»åŠ¡é“¾Aè§¦å‘å®Œæ¯•
doWork start: SimpleWorker  // ä»»åŠ¡é“¾Aè€—æ—¶ä»»åŠ¡workRequestå¼€å§‹æ‰§è¡Œ
doWork end: SimpleWorker5   // ä»»åŠ¡é“¾Bè€—æ—¶ä»»åŠ¡workRequest5æ‰§è¡Œå®Œæ¯•
doWork end: SimpleWorker    // ä»»åŠ¡é“¾Aè€—æ—¶ä»»åŠ¡workRequestæ‰§è¡Œå®Œæ¯•
doWork: SimpleWorker3       // ä»»åŠ¡é“¾Aæ‰§è¡Œåç»­ä»»åŠ¡request3
ä»»åŠ¡é“¾Bè€—æ—¶ä»»åŠ¡è¢«æ‰§è¡Œä½†åç»­æ“ä½œè¢«åŒåä»»åŠ¡é“¾Aè¦†ç›–
</code></pre>
<p>åŒç†ï¼Œæˆ‘ä»¬å°†ä»»åŠ¡é“¾Açš„å†²çªæ–¹æ¡ˆåˆ†åˆ«å®šä¹‰ä¸º<code>ExistingWorkPolicy.APPEND</code>ã€<code>ExistingWorkPolicy.APPEND_OR_REPLACE</code>ï¼Œè§‚å¯Ÿæ‰§è¡Œæƒ…å†µï¼Œå¾—å‡ºå¦‚ä¸‹ç»“è®ºï¼š</p>
<ul>
<li>ExistingWorkPolicy.REPLACE ä¼šæ›¿æ¢æ­£åœ¨æ‰§è¡Œçš„åŒåä»»åŠ¡é‡æ–°æ‰§è¡Œï¼Œå¹¶ä½¿ç”¨è‡ªå·±çš„ä»»åŠ¡é“¾è¦†ç›–åŸä»»åŠ¡é“¾ï¼›</li>
<li>ExistingWorkPolicy.KEEP ä¼šä¿æŒåŸä»»åŠ¡é“¾æ‰§è¡Œï¼Œè‡ªå·±ä¸æ‰§è¡Œï¼›</li>
<li>ExistingWorkPolicy.APPEND ä¼šç­‰å¾…åŸä»»åŠ¡é“¾åŒåä»»åŠ¡åŠåç»­ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ‰æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡é“¾ï¼›</li>
<li>ExistingWorkPolicy.APPEND_OR_REPLACE è‹¥åŸä»»åŠ¡é“¾åŠæ–°ä»»åŠ¡é“¾æœªè¢«å–æ¶ˆæˆ–ä¸­æ–­ï¼Œåˆ™<br>ä¸APPENDæ€§è´¨ä¸€è‡´, å…¶ä»–æƒ…å†µï¼š<blockquote>
<p>If there is existing pending (uncompleted) work with the same unique name, append the newly-specified work as the child of all the leaves of that work sequence. Otherwise, insert the newly-specified work as the start of a new sequence. Note: If there are failed or cancelled prerequisites, these prerequisites are dropped and the newly-specified work is the start of a new sequence.å¦‚æœå­˜åœ¨å…·æœ‰ç›¸åŒå”¯ä¸€åç§°çš„æœªå†³(æœªå®Œæˆ)å·¥ä½œï¼Œåˆ™å°†æ–°æŒ‡å®šçš„å·¥ä½œé™„åŠ ä¸ºè¯¥å·¥ä½œåºåˆ—çš„æ‰€æœ‰å¶èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ã€‚å¦åˆ™ï¼Œæ’å…¥æ–°æŒ‡å®šçš„å·¥ä½œä½œä¸ºæ–°åºåˆ—çš„å¼€å§‹ã€‚æ³¨æ„:å¦‚æœæœ‰å¤±è´¥æˆ–å–æ¶ˆçš„å…ˆå†³æ¡ä»¶ï¼Œè¿™äº›å…ˆå†³æ¡ä»¶å°†è¢«åˆ é™¤ï¼Œè€Œæ–°æŒ‡å®šçš„å·¥ä½œå°†æ˜¯ä¸€ä¸ªæ–°åºåˆ—çš„å¼€å§‹ã€‚</p>
</blockquote>
</li>
</ul>
<p><strong><span id="task_onstraint">1.4.5 ä»»åŠ¡çº¦æŸ</strong></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/workmanager/how-to/define-work#work-constraints">å‚è§æ–‡æ¡£</a></p>
<blockquote>
<p>Constraintså¯ç¡®ä¿å°†å·¥ä½œå»¶è¿Ÿåˆ°æ»¡è¶³æœ€ä½³æ¡ä»¶æ—¶è¿è¡Œã€‚ä»¥ä¸‹çº¦æŸé€‚ç”¨äº WorkManagerã€‚</p>
</blockquote>
<pre><code>NetworkType     çº¦æŸè¿è¡Œå·¥ä½œæ‰€éœ€çš„ç½‘ç»œç±»å‹ã€‚ä¾‹å¦‚ Wi-Fi (UNMETERED)ã€‚
BatteryNotLow     å¦‚æœè®¾ç½®ä¸º trueï¼Œé‚£ä¹ˆå½“è®¾å¤‡å¤„äºâ€œç”µé‡ä¸è¶³æ¨¡å¼â€æ—¶ï¼Œå·¥ä½œä¸ä¼šè¿è¡Œã€‚
RequiresCharging     å¦‚æœè®¾ç½®ä¸º trueï¼Œé‚£ä¹ˆå·¥ä½œåªèƒ½åœ¨è®¾å¤‡å……ç”µæ—¶è¿è¡Œã€‚
DeviceIdle     å¦‚æœè®¾ç½®ä¸º trueï¼Œåˆ™è¦æ±‚ç”¨æˆ·çš„è®¾å¤‡å¿…é¡»å¤„äºç©ºé—²çŠ¶æ€ï¼Œæ‰èƒ½è¿è¡Œå·¥ä½œã€‚å¦‚æœæ‚¨è¦è¿è¡Œæ‰¹é‡æ“ä½œï¼Œå¦åˆ™å¯èƒ½ä¼šé™ä½ç”¨æˆ·è®¾å¤‡ä¸Šæ­£åœ¨ç§¯æè¿è¡Œçš„å…¶ä»–åº”ç”¨çš„æ€§èƒ½ï¼Œå»ºè®®æ‚¨ä½¿ç”¨æ­¤çº¦æŸã€‚
StorageNotLow     å¦‚æœè®¾ç½®ä¸º trueï¼Œé‚£ä¹ˆå½“ç”¨æˆ·è®¾å¤‡ä¸Šçš„å­˜å‚¨ç©ºé—´ä¸è¶³æ—¶ï¼Œå·¥ä½œä¸ä¼šè¿è¡Œ
</code></pre>
<p>æ³¨æ„ï¼š<br>å®é™…æµ‹è¯•ä¸­ï¼Œä½¿ç”¨Android 6.0~11.0ç­‰ä¸€ç³»åˆ—ç‰ˆæœ¬çš„æ¨¡æ‹Ÿå™¨æµ‹è¯•å‘ç°</p>
<ul>
<li>9.0ä»¥ä¸‹ç‰ˆæœ¬æ‰‹æœºï¼Œä¸è®ºåº”ç”¨æ˜¯å¦åœ¨å‰å°ï¼Œè¿›ç¨‹æ˜¯å¦å­˜æ´»ï¼Œåªè¦æ»¡è¶³çº¦æŸæ¡ä»¶ä»»åŠ¡å°±ä¼šå°½å¿«æ‰§è¡Œï¼›</li>
<li>9.0åŠä»¥ä¸Šç‰ˆæœ¬æ‰‹æœºï¼Œåº”ç”¨è¿›ç¨‹DEADçŠ¶æ€ï¼Œåœ¨ç¬¦åˆçº¦æŸæ¡ä»¶æ—¶ä»»åŠ¡ä¹Ÿä¸ä¸€å®šä¼šå°½å¿«æ‰§è¡Œï¼Œç”šè‡³å³ä½¿è¿›å…¥Appä¹Ÿä¸ä¸€å®šèƒ½ç«‹é©¬å¾—åˆ°æ‰§è¡Œï¼Œé™¤éæœ‰æ–°çš„WorkRequestå…¥é˜Ÿã€‚</li>
</ul>
<p><strong><span id="task_delay">1.4.6 ä»»åŠ¡å»¶æ—¶</strong></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/workmanager/how-to/define-work#delayed_work">å‚è§æ–‡æ¡£</a></p>
<blockquote>
<p>å¦‚æœå·¥ä½œæ²¡æœ‰çº¦æŸï¼Œæˆ–è€…å½“å·¥ä½œåŠ å…¥é˜Ÿåˆ—æ—¶æ‰€æœ‰çº¦æŸéƒ½å¾—åˆ°äº†æ»¡è¶³ï¼Œé‚£ä¹ˆç³»ç»Ÿå¯èƒ½ä¼šé€‰æ‹©ç«‹å³è¿è¡Œè¯¥å·¥ä½œã€‚å¦‚æœæ‚¨ä¸å¸Œæœ›å·¥ä½œç«‹å³è¿è¡Œï¼Œå¯ä»¥å°†å·¥ä½œæŒ‡å®šä¸ºåœ¨ç»è¿‡ä¸€æ®µæœ€çŸ­åˆå§‹å»¶è¿Ÿæ—¶é—´åå†å¯åŠ¨ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">WorkRequest myWorkRequest &#x3D;</span><br><span class="line">      new OneTimeWorkRequest.Builder(MyWork.class)</span><br><span class="line">               .setInitialDelay(10, TimeUnit.MINUTES)</span><br><span class="line">               .build();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šæ‰§è¡Œå·¥ä½œå™¨çš„ç¡®åˆ‡æ—¶é—´è¿˜å–å†³äº WorkRequest ä¸­ä½¿ç”¨çš„çº¦æŸå’Œç³»ç»Ÿä¼˜åŒ–æ–¹å¼ã€‚WorkManager ç»è¿‡è®¾è®¡ï¼Œèƒ½å¤Ÿåœ¨æ»¡è¶³è¿™äº›çº¦æŸçš„æƒ…å†µä¸‹æä¾›å¯èƒ½çš„æœ€ä½³è¡Œä¸ºã€‚<br>å®šæœŸå·¥ä½œåªæœ‰é¦–æ¬¡è¿è¡Œæ—¶ä¼šå»¶è¿Ÿ</p>
</blockquote>
<p><strong><span id="retry_rollback">1.4.7 é‡è¯•å’Œé€€é¿æ”¿ç­–</strong></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/workmanager/how-to/define-work#retry_and_backoff_policy">å‚è§æ–‡æ¡£</a></p>
<p>è‹¥Workerè¿”å›ç»“æœResult.retry()æ—¶ï¼Œè§¦å‘é‡è¯•é€€é¿æ”¿ç­–ï¼Œå³ä¸‹æ¬¡è°ƒåº¦Workeråº”åœ¨å¤šé•¿æ—¶é—´ä»¥åï¼Œæ”¯æŒè®¾ç½®é€€é¿æ—¶é—´åŸºæ•°å’ŒåŸºæ•°é€’å¢æ–¹å¼ï¼Œé€’å¢æ–¹å¼ç›®å‰æ”¯æŒçº¿æ€§<code>LINEAR</code>å’ŒæŒ‡æ•°<code>EXPONENTIAL</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">OneTimeWorkRequest workRequest &#x3D; new OneTimeWorkRequest.Builder(RetryWorker.class)</span><br><span class="line">                .setBackoffCriteria(BackoffPolicy.LINEAR,</span><br><span class="line">                        OneTimeWorkRequest.MIN_BACKOFF_MILLIS,</span><br><span class="line">                        TimeUnit.MILLISECONDS)</span><br><span class="line">                .build();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šé€€é¿å»¶è¿Ÿæ—¶é—´ä¸ç²¾ç¡®ï¼Œåœ¨ä¸¤æ¬¡é‡è¯•ä¹‹é—´å¯èƒ½ä¼šæœ‰å‡ ç§’é’Ÿçš„å·®å¼‚ï¼Œä½†ç»ä¸ä¼šä½äºé…ç½®ä¸­æŒ‡å®šçš„åˆå§‹é€€é¿å»¶è¿Ÿæ—¶é—´ã€‚</p>
</blockquote>
<p>é€€é¿æ—¶é—´åœ¨æ»¡è¶³æ‰§è¡Œæ¡ä»¶æƒ…å†µä¸‹ä¹Ÿå¹¶ä¸ä¼šå®Œå…¨ç²¾ç¡®ï¼Œè‹¥ä¸æ»¡è¶³æ‰§è¡Œæ¡ä»¶åˆ™ä¼šç­‰å¾…å…¶æ¡ä»¶æ»¡è¶³ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; æ— çº¦æŸ</span><br><span class="line">é—´éš”æ—¶é—´(ms): 10109 </span><br><span class="line">é—´éš”æ—¶é—´(ms): 20094</span><br><span class="line">é—´éš”æ—¶é—´(ms): 30093</span><br><span class="line">...</span><br><span class="line">&#x2F;&#x2F; çº¦æŸï¼šè®¡è´¹(é‡)ç½‘ç»œç¯å¢ƒä¸‹</span><br><span class="line">é—´éš”æ—¶é—´(ms): 10121</span><br><span class="line">é—´éš”æ—¶é—´(ms): 20143</span><br><span class="line">é—´éš”æ—¶é—´(ms): 30103</span><br><span class="line">&#x2F;&#x2F; å…³é—­wifiå–ä¸ªèŒ¶å†è¿æ¥wifi</span><br><span class="line">é—´éš”æ—¶é—´(ms): 146521</span><br><span class="line">é—´éš”æ—¶é—´(ms): 50132</span><br></pre></td></tr></table></figure>
<p><strong><span id="work_tag">1.4.8 æ ‡è®°å·¥ä½œ</strong></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/workmanager/how-to/define-work#tag_work">å‚è§æ–‡æ¡£</a></p>
<p>ä½ å¯ä»¥ä¸ºWorkRequestæ·»åŠ tagï¼Œä»è€Œä½¿å¾—ä½ å¯ä»¥é€šè¿‡<code>WorkManager.getWorkInfosByTag(String)</code>è·å–WorkRequestçš„å·¥ä½œçŠ¶æ€WorkInfoï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡<code>WorkManager.cancelAllWorkByTag(String)</code>å–æ¶ˆå¯¹åº”æ ‡è®°çš„æ‰€æœ‰WorkRequest.</p>
<p>ç”±WorkRequestä¸­å…³äºtagçš„å®šä¹‰<code>Set<String> mTags</code>å¯çŸ¥ï¼Œä½ å¯ä»¥ä¸ºWorkRequestå®šä¹‰å¤šä¸ªæ ‡è®°ï¼Œå½“ç„¶çš„ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ºå¤šä¸ªWorkRequestå®šä¹‰åŒä¸€ä¸ªæ ‡è®°ç”¨ä»¥ç»Ÿä¸€ç®¡ç†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">WorkRequest request &#x3D;</span><br><span class="line">       new OneTimeWorkRequest.Builder(SimpleWorker.class)</span><br><span class="line">       .addTag(&quot;TAG&quot;)</span><br><span class="line">       .build();</span><br><span class="line">&#x2F;&#x2F; æ ¹æ®tagå–æ¶ˆä»»åŠ¡</span><br><span class="line">WorkManager.getInstance(this).cancelAllWorkByTag(&quot;TAG&quot;);</span><br><span class="line">&#x2F;&#x2F; æ ¹æ®tagæŸ¥æ‰¾ä»»åŠ¡çŠ¶æ€</span><br><span class="line">WorkManager.getInstance(this).getWorkInfosByTag(&quot;TAG&quot;);</span><br></pre></td></tr></table></figure>
<p><strong><span id="work_cancel">1.4.9 å–æ¶ˆå·¥ä½œ</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; by id</span><br><span class="line">workManager.cancelWorkById(syncWorker.id);</span><br><span class="line">&#x2F;&#x2F; by name</span><br><span class="line">workManager.cancelUniqueWork(&quot;sync&quot;);</span><br><span class="line">&#x2F;&#x2F; by tag</span><br><span class="line">workManager.cancelAllWorkByTag(&quot;syncTag&quot;);</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/workmanager/how-to/managing-work#stop-worker">ç‚¹æ­¤äº†è§£â€œåœæ­¢æ­£åœ¨è¿è¡Œçš„å·¥ä½œå™¨â€çš„ç›¸å…³å†…å®¹</a></p>
<h4 id="1-5-æ³¨æ„äº‹é¡¹"><a href="#1-5-æ³¨æ„äº‹é¡¹" class="headerlink" title=" 1.5 æ³¨æ„äº‹é¡¹"></a><span id="attention"> 1.5 æ³¨æ„äº‹é¡¹</h4><p>è¿™é‡Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä½¿ç”¨WorkManagerçš„ä¸€äº›å°Tipsã€‚</p>
<ul>
<li>PeriodicWorkRequestå‘¨æœŸä»»åŠ¡å¯ä»¥å®šä¹‰çš„æœ€çŸ­é‡å¤é—´éš”æ˜¯ 15 åˆ†é’Ÿï¼ˆä¸ JobScheduler API ç›¸åŒï¼‰</li>
<li>å»¶è¿Ÿå·¥ä½œï¼šæ‰§è¡Œå·¥ä½œå™¨çš„ç¡®åˆ‡æ—¶é—´è¿˜å–å†³äº WorkRequest ä¸­ä½¿ç”¨çš„çº¦æŸå’Œç³»ç»Ÿä¼˜åŒ–æ–¹å¼ã€‚WorkManager ç»è¿‡è®¾è®¡ï¼Œèƒ½å¤Ÿåœ¨æ»¡è¶³è¿™äº›çº¦æŸçš„æƒ…å†µä¸‹æä¾›å¯èƒ½çš„æœ€ä½³è¡Œä¸ºã€‚</li>
<li>é€€é¿å»¶è¿Ÿæ—¶é—´ä¸ç²¾ç¡®ï¼Œåœ¨ä¸¤æ¬¡é‡è¯•ä¹‹é—´å¯èƒ½ä¼šæœ‰å‡ ç§’é’Ÿçš„å·®å¼‚ï¼Œä½†ç»ä¸ä¼šä½äºé…ç½®ä¸­æŒ‡å®šçš„åˆå§‹é€€é¿å»¶è¿Ÿæ—¶é—´ã€‚</li>
<li>cancelAllWorkByTag(String) ä¼šå–æ¶ˆå…·æœ‰ç»™å®šæ ‡è®°çš„æ‰€æœ‰å·¥ä½œã€‚</li>
<li>WorkRequestä¿è¯ä¸€å®šæ‰§è¡Œï¼Œä½†ä¸ä¿è¯ä¸€å®šåœ¨ä»€ä¹ˆæ—¶é—´æ‰§è¡Œã€‚</li>
</ul>
<hr>
<p>å¼•ç”¨æ–‡çŒ®ï¼š</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/workmanager">WorkManagerå®˜æ–¹æ–‡æ¡£</a></li>
</ol>
<h4 id="æºç ç¯‡æ­£åœ¨å¥‹åŠ›ç å­—ä¸­ã€‚ã€‚ã€‚"><a href="#æºç ç¯‡æ­£åœ¨å¥‹åŠ›ç å­—ä¸­ã€‚ã€‚ã€‚" class="headerlink" title="æºç ç¯‡æ­£åœ¨å¥‹åŠ›ç å­—ä¸­ã€‚ã€‚ã€‚"></a>æºç ç¯‡æ­£åœ¨å¥‹åŠ›ç å­—ä¸­ã€‚ã€‚ã€‚</h4>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/WorkManager/" rel="tag"># WorkManager</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/02/06/WorkManager%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%8F%8A%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90(%E4%BA%94)%20-%20Processor/" rel="prev" title="WorkManageråŸºæœ¬ä½¿ç”¨åŠæºç åˆ†æ(äº”) - Processor">
      <i class="fa fa-chevron-left"></i> WorkManageråŸºæœ¬ä½¿ç”¨åŠæºç åˆ†æ(äº”) - Processor
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/02/06/WorkManager%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%8F%8A%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90(%E4%BA%8C)%20-%20WorkManagerInitializer/" rel="next" title="WorkManageråŸºæœ¬ä½¿ç”¨åŠæºç åˆ†æ(äºŒ) - WorkManagerInitializer">
      WorkManageråŸºæœ¬ä½¿ç”¨åŠæºç åˆ†æ(äºŒ) - WorkManagerInitializer <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95"><span class="nav-number">1.</span> <span class="nav-text">ç›®å½•</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ZERO"><span class="nav-number">1.1.</span> <span class="nav-text">ZERO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BD%BF%E7%94%A8%E7%AF%87"><span class="nav-number">1.2.</span> <span class="nav-text"> 1. ä½¿ç”¨ç¯‡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-%E5%A3%B0%E6%98%8E%E4%BE%9D%E8%B5%96%E9%A1%B9"><span class="nav-number">1.2.1.</span> <span class="nav-text"> 1.1 å£°æ˜ä¾èµ–é¡¹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-%E8%AF%A5%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="nav-number">1.2.2.</span> <span class="nav-text"> 1.2 è¯¥å¦‚ä½•ä½¿ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-WorkRequest%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.2.3.</span> <span class="nav-text"> 1.3 WorkRequestç±»å‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-%E4%B8%80%E8%88%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">1.2.4.</span> <span class="nav-text"> 1.4 ä¸€èˆ¬æ“ä½œ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">1.2.5.</span> <span class="nav-text"> 1.5 æ³¨æ„äº‹é¡¹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E7%AF%87%E6%AD%A3%E5%9C%A8%E5%A5%8B%E5%8A%9B%E7%A0%81%E5%AD%97%E4%B8%AD%E3%80%82%E3%80%82%E3%80%82"><span class="nav-number">1.2.6.</span> <span class="nav-text">æºç ç¯‡æ­£åœ¨å¥‹åŠ›ç å­—ä¸­ã€‚ã€‚ã€‚</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Tinlone"
      src="https://s3.ax1x.com/2021/02/24/yXYu7R.png">
  <p class="site-author-name" itemprop="name">Tinlone</p>
  <div class="site-description" itemprop="description">Tinloneçš„ä¸ªäººåšå®¢</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
	
	<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=16435049&auto=1&height=66"></iframe>
	
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tinlone</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">32k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">29 åˆ†é’Ÿ</span>
</div>
<!--
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>
-->

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true}});</script></body>
</html>

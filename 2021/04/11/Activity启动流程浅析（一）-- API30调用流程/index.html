<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-material.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tinlone.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="å‰è¨€Activityä¸€èˆ¬æ˜¯å®‰å“å¼€å‘æ¥è§¦åˆ°çš„ç¬¬ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œä»£è¡¨ç€ä¸ç”¨æˆ·äº¤äº’çš„æ´»åŠ¨è§†çª—ï¼Œæ´»åŠ¨ä¸æ´»åŠ¨ä¹‹é—´å¾€å¾€ä¸æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼ŒstartActivity()å°±æ˜¯ä»ä¸€ä¸ªæ´»åŠ¨è·³è½¬åˆ°å¦ä¸€ä¸ªæ´»åŠ¨çš„æ¡¥æ¢ã€‚è€Œå¯¹äºstartActivity()çš„äº†è§£ï¼Œæˆ‘ä»¬å¾€å¾€åªåœç•™åœ¨å®ƒçš„ä½¿ç”¨ä¸Šï¼Œå¾ˆå°‘å»æ·±ç©¶å®ƒçš„åŸç†ã€‚ ä»Šå¤©ï¼Œå°±è®©æˆ‘ä»¬è·Ÿéšç€æºç ï¼Œä¸€æ­¥ä¸€æ­¥çš„è¿½æº¯å®ƒçš„è°ƒç”¨æµç¨‹ï¼Œåˆæ­¥äº†è§£ä¸‹å®ƒçš„è°ƒç”¨é“¾ï¼Œåç»­æˆ‘ä»¬è¿˜å¯ä»¥ç»§ç»­æŒ–æ˜ï¼Œå…³äºåº”ç”¨å¯åŠ¨ã€å¯åŠ¨">
<meta property="og:type" content="article">
<meta property="og:title" content="Activityå¯åŠ¨æµç¨‹æµ…æï¼ˆä¸€ï¼‰-- è°ƒç”¨æµç¨‹">
<meta property="og:url" content="http://tinlone.com/2021/04/11/Activity%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E6%B5%85%E6%9E%90%EF%BC%88%E4%B8%80%EF%BC%89--%20API30%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B/index.html">
<meta property="og:site_name" content="Tinlone">
<meta property="og:description" content="å‰è¨€Activityä¸€èˆ¬æ˜¯å®‰å“å¼€å‘æ¥è§¦åˆ°çš„ç¬¬ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œä»£è¡¨ç€ä¸ç”¨æˆ·äº¤äº’çš„æ´»åŠ¨è§†çª—ï¼Œæ´»åŠ¨ä¸æ´»åŠ¨ä¹‹é—´å¾€å¾€ä¸æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼ŒstartActivity()å°±æ˜¯ä»ä¸€ä¸ªæ´»åŠ¨è·³è½¬åˆ°å¦ä¸€ä¸ªæ´»åŠ¨çš„æ¡¥æ¢ã€‚è€Œå¯¹äºstartActivity()çš„äº†è§£ï¼Œæˆ‘ä»¬å¾€å¾€åªåœç•™åœ¨å®ƒçš„ä½¿ç”¨ä¸Šï¼Œå¾ˆå°‘å»æ·±ç©¶å®ƒçš„åŸç†ã€‚ ä»Šå¤©ï¼Œå°±è®©æˆ‘ä»¬è·Ÿéšç€æºç ï¼Œä¸€æ­¥ä¸€æ­¥çš„è¿½æº¯å®ƒçš„è°ƒç”¨æµç¨‹ï¼Œåˆæ­¥äº†è§£ä¸‹å®ƒçš„è°ƒç”¨é“¾ï¼Œåç»­æˆ‘ä»¬è¿˜å¯ä»¥ç»§ç»­æŒ–æ˜ï¼Œå…³äºåº”ç”¨å¯åŠ¨ã€å¯åŠ¨">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://z3.ax1x.com/2021/04/11/cwgcp6.png">
<meta property="article:published_time" content="2021-04-11T10:05:00.592Z">
<meta property="article:modified_time" content="2021-04-11T10:04:40.301Z">
<meta property="article:author" content="Tinlone">
<meta property="article:tag" content="Activity">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://z3.ax1x.com/2021/04/11/cwgcp6.png">

<link rel="canonical" href="http://tinlone.com/2021/04/11/Activity%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E6%B5%85%E6%9E%90%EF%BC%88%E4%B8%80%EF%BC%89--%20API30%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Activityå¯åŠ¨æµç¨‹æµ…æï¼ˆä¸€ï¼‰-- è°ƒç”¨æµç¨‹ | Tinlone</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Tinlone</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">å •è½çš„ğŸŸ</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://tinlone.com/2021/04/11/Activity%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E6%B5%85%E6%9E%90%EF%BC%88%E4%B8%80%EF%BC%89--%20API30%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon-32x32-next.png">
      <meta itemprop="name" content="Tinlone">
      <meta itemprop="description" content="Tinloneçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tinlone">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Activityå¯åŠ¨æµç¨‹æµ…æï¼ˆä¸€ï¼‰-- è°ƒç”¨æµç¨‹
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-04-11 18:05:00 / ä¿®æ”¹æ—¶é—´ï¼š18:04:40" itemprop="dateCreated datePublished" datetime="2021-04-11T18:05:00+08:00">2021-04-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/framework/" itemprop="url" rel="index"><span itemprop="name">framework</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>4.8k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>4 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>Activityä¸€èˆ¬æ˜¯å®‰å“å¼€å‘æ¥è§¦åˆ°çš„ç¬¬ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œä»£è¡¨ç€ä¸ç”¨æˆ·äº¤äº’çš„æ´»åŠ¨è§†çª—ï¼Œæ´»åŠ¨ä¸æ´»åŠ¨ä¹‹é—´å¾€å¾€ä¸æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œ<code>startActivity()</code>å°±æ˜¯ä»ä¸€ä¸ªæ´»åŠ¨è·³è½¬åˆ°å¦ä¸€ä¸ªæ´»åŠ¨çš„æ¡¥æ¢ã€‚è€Œå¯¹äº<code>startActivity()</code>çš„äº†è§£ï¼Œæˆ‘ä»¬å¾€å¾€åªåœç•™åœ¨å®ƒçš„ä½¿ç”¨ä¸Šï¼Œå¾ˆå°‘å»æ·±ç©¶å®ƒçš„åŸç†<br>ã€‚</p>
<p>ä»Šå¤©ï¼Œå°±è®©æˆ‘ä»¬è·Ÿéšç€æºç ï¼Œä¸€æ­¥ä¸€æ­¥çš„è¿½æº¯å®ƒçš„è°ƒç”¨æµç¨‹ï¼Œåˆæ­¥äº†è§£ä¸‹å®ƒçš„è°ƒç”¨é“¾ï¼Œåç»­æˆ‘ä»¬è¿˜å¯ä»¥ç»§ç»­æŒ–æ˜ï¼Œå…³äºåº”ç”¨å¯åŠ¨ã€å¯åŠ¨æ¨¡å¼ã€hookå¯åŠ¨æµç¨‹ç­‰ç›¸å…³æŠ€æœ¯æ”¯æŒã€‚</p>
<p>æ­¤ç³»åˆ—åšå®¢åœ¨æœªå£°æ˜APIç‰ˆæœ¬æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨<strong>API30</strong> ç‰ˆæœ¬çš„AndroidSDKæºç ã€‚</p>
<p>æºç æŸ¥çœ‹å·¥å…·ä½¿ç”¨AndroidStudioã€‚æºç æ¥æº<code>%AndroidSDK%/sources</code>ã€‚ä¸€èˆ¬æ–¹å¼ï¼šå¤‡ä»½ä¸€ä»½sourceç›®å½•ï¼Œä½¿ç”¨AndroidStudio Openä½ æƒ³è§‚å¯Ÿçš„apiç‰ˆæœ¬çš„æºç ç›®å½•ã€‚</p>
<a id="more"></a>

<h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><h4 id="Activity-startActivity"><a href="#Activity-startActivity" class="headerlink" title="Activity.startActivity()"></a>Activity.startActivity()</h4><p>æˆ‘ä»¬æ—¥å¸¸ç¼–å†™çš„<code>activity.startActivity(intent)</code>çš„ä»£ç ï¼Œå®é™…æ˜¯è°ƒç”¨ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;@link android.app.Activity#startActivity&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivity</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.startActivity(intent, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivity</span><span class="params">(Intent intent, <span class="meta">@Nullable</span> Bundle options)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// API 30 æ­¤å¤„æ–°å¢å…³äºè‡ªåŠ¨å¡«å……ç›¸å…³çš„å¤„ç†ä»£ç ï¼ŒAPI26æ— æ­¤é¡¹</span></span><br><span class="line">    <span class="keyword">if</span> (options != <span class="keyword">null</span>) &#123;</span><br><span class="line">        startActivityForResult(intent, -<span class="number">1</span>, options);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Note we want to go through this call for compatibility with</span></span><br><span class="line">        <span class="comment">// applications that may have overridden the method.</span></span><br><span class="line">        startActivityForResult(intent, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Activity-startActivityForResult"><a href="#Activity-startActivityForResult" class="headerlink" title="Activity.startActivityForResult()"></a>Activity.startActivityForResult()</h4><p>æœ‰ä¸Šè¿°ä»£ç å¯çŸ¥ï¼ŒstartActivity() å®é™…æ˜¯è°ƒç”¨ startActivityForResult()ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;@link android.app.Activity#startActivityForResult&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivityForResult</span><span class="params">(<span class="meta">@RequiresPermission</span> Intent intent, <span class="keyword">int</span> requestCode,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="meta">@Nullable</span> Bundle options)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mParent == <span class="keyword">null</span>) &#123;</span><br><span class="line">        options = transferSpringboardActivityOptions(options);</span><br><span class="line">        <span class="comment">// æ³¨æ„æ­¤å¤„ï¼ŒmMainThread.getApplicationThread() å®é™…ä¸º IApplicationThread</span></span><br><span class="line">        Instrumentation.ActivityResult ar =</span><br><span class="line">            mInstrumentation.execStartActivity(</span><br><span class="line">                <span class="keyword">this</span>, mMainThread.getApplicationThread(), mToken, <span class="keyword">this</span>,</span><br><span class="line">                intent, requestCode, options);</span><br><span class="line">        <span class="keyword">if</span> (ar != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mMainThread.sendActivityResult(</span><br><span class="line">                mToken, mEmbeddedID, requestCode, ar.getResultCode(),</span><br><span class="line">                ar.getResultData());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (requestCode &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœè¿™ä¸ªstartè¯·æ±‚ä¸€ä¸ªç»“æœï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ”¶åˆ°ç»“æœä¹‹å‰é¿å…ä½¿æ´»åŠ¨å¯è§ã€‚</span></span><br><span class="line">            <span class="comment">//åœ¨onCreate(Bundle savedInstanceState)æˆ–onResume()æœŸé—´è®¾ç½®æ­¤ä»£ç å°†ä¿æŒæ´»åŠ¨åœ¨æ­¤æœŸé—´éšè—ï¼Œä»¥é¿å…é—ªçƒã€‚</span></span><br><span class="line">            <span class="comment">//è¿™åªèƒ½åœ¨è¯·æ±‚ç»“æœæ—¶æ‰§è¡Œï¼Œå› ä¸ºè¿™ä¿è¯äº†æ— è®ºæ´»åŠ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬éƒ½ä¼šåœ¨æ´»åŠ¨å®Œæˆæ—¶è·å¾—ä¿¡æ¯</span></span><br><span class="line">            mStartedActivity = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        cancelInputsAndStartExitTransition(options);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å®é™…ä¹Ÿæ˜¯è°ƒç”¨mInstrumentation.execStartActivity(this, mMainThread.getApplicationThread(), mToken, this, intent, requestCode, options);æ­¤å¤„ä¸åšèµ˜è¿°</span></span><br><span class="line">        <span class="keyword">if</span> (options != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mParent.startActivityFromChild(<span class="keyword">this</span>, intent, requestCode, options);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ³¨æ„ï¼Œæˆ‘ä»¬æƒ³è¦éå†è¿™ä¸ªæ–¹æ³•ï¼Œä»¥ä¾¿ä¸å¯èƒ½å·²è¦†ç›–å®ƒçš„ç°æœ‰åº”ç”¨ç¨‹åºå…¼å®¹ã€‚</span></span><br><span class="line">            mParent.startActivityFromChild(<span class="keyword">this</span>, intent, requestCode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„ï¼Œæˆ‘ä»¬æŠ›å¼€å…¶ä»–ä»£ç ï¼Œå…³æ³¨è¿™é‡Œçš„if else æœ€ç»ˆéƒ½æ˜¯è°ƒç”¨mInstrumentation.execStartActivity()ï¼Œä»å­—é¢æ„ä¹‰ä¸Šè¯´ï¼Œå®ƒä»£è¡¨â€œæ‰§è¡Œå¯åŠ¨æ´»åŠ¨â€ï¼Œæ˜¾ç„¶æˆ‘ä»¬åº”å½“å…³æ³¨æ­¤æ–¹æ³•ã€‚</p>
<h4 id="Instrumentation-execStartActivity"><a href="#Instrumentation-execStartActivity" class="headerlink" title="Instrumentation.execStartActivity()"></a>Instrumentation.execStartActivity()</h4><p>Instrumentationç±»ã€‚æ­¤å¤„æˆ‘ä»¬ä¸åšè¯¦ç»†åˆ†æï¼Œä½†åº”å½“çŸ¥é“çš„æ˜¯ï¼Œå®ƒçš„ä½œç”¨åŠèƒ½åŠ›ï¼š</p>
<blockquote>
<p>å®ç°åº”ç”¨ç¨‹åºæ’è£…ä»£ç çš„åŸºç±»ã€‚åœ¨å¯åŠ¨æ’è£…çš„æƒ…å†µä¸‹è¿è¡Œæ—¶ï¼Œè¿™ä¸ªç±»å°†åœ¨ä»»ä½•åº”ç”¨ç¨‹åºä»£ç ä¹‹å‰ä¸ºæ‚¨å®ä¾‹åŒ–ï¼Œå…è®¸æ‚¨ç›‘è§†ç³»ç»Ÿä¸åº”ç”¨ç¨‹åºä¹‹é—´çš„æ‰€æœ‰äº¤äº’ã€‚é€šè¿‡AndroidManifest.xmlçš„&lt; Instrumentation &gt;æ ‡ç­¾å‘ç³»ç»Ÿæè¿°äº†ä¸€ä¸ªInstrumentationå®ç°ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;@link android.app.Instrumentation#execStartActivity&#125;</span><br><span class="line"><span class="meta">@UnsupportedAppUsage</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ActivityResult <span class="title">execStartActivity</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        Context who, IBinder contextThread, IBinder token, Activity target,</span></span></span><br><span class="line"><span class="function"><span class="params">        Intent intent, <span class="keyword">int</span> requestCode, Bundle options)</span> </span>&#123;</span><br><span class="line">    IApplicationThread whoThread = (IApplicationThread) contextThread;</span><br><span class="line">    <span class="comment">// æ­¤å¤„çœç•¥ä»£ç </span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        intent.migrateExtraStreamToClipData(who);</span><br><span class="line">        intent.prepareToLeaveProcess(who);</span><br><span class="line">        <span class="comment">// æ³¨æ„æ­¤å¤„</span></span><br><span class="line">        <span class="keyword">int</span> result = ActivityTaskManager.getService().startActivity(whoThread,</span><br><span class="line">                who.getBasePackageName(), who.getAttributionTag(), intent,</span><br><span class="line">                intent.resolveTypeIfNeeded(who.getContentResolver()), token,</span><br><span class="line">                target != <span class="keyword">null</span> ? target.mEmbeddedID : <span class="keyword">null</span>, requestCode, <span class="number">0</span>, <span class="keyword">null</span>, options);</span><br><span class="line">        checkStartActivityResult(result, intent);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Failure from system&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒInstrumentation.execStartActivity()è°ƒç”¨äº†ActivityTaskManager.getService().startActivity()å°†å¯åŠ¨æ´»åŠ¨å§”æ‰˜ç»™äº†æŸä¸ªâ€œæœåŠ¡â€æ‰§è¡Œï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªâ€œæœåŠ¡â€æ˜¯ä»€ä¹ˆã€‚</p>
<h4 id="ActivityTaskManager-getService"><a href="#ActivityTaskManager-getService" class="headerlink" title="ActivityTaskManager.getService()"></a>ActivityTaskManager.getService()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="meta">@link</span> android.app.ActivityTaskManager&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IActivityTaskManager <span class="title">getService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> IActivityTaskManagerSingleton.get();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@UnsupportedAppUsage(trackingBug = 129726065)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton&lt;IActivityTaskManager&gt; IActivityTaskManagerSingleton =</span><br><span class="line">        <span class="keyword">new</span> Singleton&lt;IActivityTaskManager&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> IActivityTaskManager <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">final</span> IBinder b = ServiceManager.getService(Context.ACTIVITY_TASK_SERVICE);</span><br><span class="line">                <span class="keyword">return</span> IActivityTaskManager.Stub.asInterface(b);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä»£ç çš„ä½œç”¨å…¶å®æ˜¯é€šè¿‡è·å–IBinderç±»å‹çš„æœåŠ¡ç”Ÿäº§ä¸€ä¸ªå¯åŠ¨æ´»åŠ¨çš„ä»£ç†ç±»ï¼Œå®ç°æ–¹å¼ï¼š <strong>ä½¿ç”¨çš„æ˜¯åä¸ºACTIVITY_TASK_SERVICEçš„IBinderç”Ÿäº§äº†ä¸€ä¸ªIActivityTaskManager</strong>ã€‚</p>
<p>ä½¿ç”¨è¿‡AIDLçš„åŒå­¦åº”è¯¥çœ‹å‡ºæ¥äº†ï¼Œè¿™é‡Œç±»ä¼¼çš„ï¼Œä¹Ÿæ˜¯é€šè¿‡è·¨è¿›ç¨‹é€šä¿¡çš„æ–¹å¼æ“ä½œçš„ã€‚</p>
<h4 id="IActivityTaskManager-startActivity"><a href="#IActivityTaskManager-startActivity" class="headerlink" title="IActivityTaskManager.startActivity()"></a>IActivityTaskManager.startActivity()</h4><p>ç”±äºæˆ‘ä»¬æ²¡åŠæ³•ç›´æ¥è·å–åˆ°IActivityTaskManagerçš„å®ç°ç±»ï¼Œæˆ‘ä»¬é€šè¿‡æœç´¢<code>IActivityTaskManager.Stub</code>çš„å®ç°ç±»æ¥å¯»æ‰¾å‰é¢æåˆ°çš„â€œæœåŠ¡â€å…·ä½“æ˜¯ä»€ä¹ˆã€‚</p>
<p><img src="https://z3.ax1x.com/2021/04/11/cwgcp6.png" alt="api30_IActivityTaskManager"></p>
<p>ç”±ä¸Šå›¾å¯çŸ¥ï¼Œè¿™ä¸ªâ€œæœåŠ¡â€åº”è¯¥å°±æ˜¯<code>com.android.server.wm.ActivityTaskManagerService</code>ï¼Œæˆ‘ä»¬æ‰¾åˆ°startActivity()æ–¹æ³•ï¼ŒéªŒè¯å…¶å…¥å‚æ˜¯å¦ä¸€è‡´ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="meta">@link</span> com.android.server.wm.ActivityTaskManagerService&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">startActivity</span><span class="params">(IApplicationThread caller, String callingPackage,</span></span></span><br><span class="line"><span class="function"><span class="params">        String callingFeatureId, Intent intent, String resolvedType, IBinder resultTo,</span></span></span><br><span class="line"><span class="function"><span class="params">        String resultWho, <span class="keyword">int</span> requestCode, <span class="keyword">int</span> startFlags, ProfilerInfo profilerInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">        Bundle bOptions)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> startActivityAsUser(caller, callingPackage, callingFeatureId, intent, resolvedType,</span><br><span class="line">            resultTo, resultWho, requestCode, startFlags, profilerInfo, bOptions,</span><br><span class="line">            UserHandle.getCallingUserId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡å…¥å‚æ¯”å¯¹ï¼ŒåŸºæœ¬ç¡®è®¤æ­¤æ–¹æ³•æ˜¯Instrumentation.execStartActivity()ä¸­è°ƒç”¨<code>ActivityTaskManager.getService().startActivity()</code>çš„åç»­æµç¨‹äº†ã€‚</p>
<p><strong>ActivityTaskManagerService.startActivityAsUser</strong></p>
<p>startActivityAsUseråŒ…å«ä¸€ç³»åˆ—é‡è½½æ–¹æ³•ï¼Œæœ€ç»ˆéƒ½æ˜¯æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="meta">@link</span> com.android.server.wm.ActivityTaskManagerService&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">startActivityAsUser</span><span class="params">(IApplicationThread caller, String callingPackage,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="meta">@Nullable</span> String callingFeatureId, Intent intent, String resolvedType,</span></span></span><br><span class="line"><span class="function"><span class="params">        IBinder resultTo, String resultWho, <span class="keyword">int</span> requestCode, <span class="keyword">int</span> startFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">        ProfilerInfo profilerInfo, Bundle bOptions, <span class="keyword">int</span> userId, <span class="keyword">boolean</span> validateIncomingUser)</span> </span>&#123;</span><br><span class="line">    assertPackageMatchesCallingUid(callingPackage);</span><br><span class="line">    enforceNotIsolatedCaller(<span class="string">&quot;startActivityAsUser&quot;</span>);</span><br><span class="line"></span><br><span class="line">    userId = getActivityStartController().checkTargetUser(userId, validateIncomingUser,</span><br><span class="line">            Binder.getCallingPid(), Binder.getCallingUid(), <span class="string">&quot;startActivityAsUser&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Switch to user app stacks here.</span></span><br><span class="line">    <span class="comment">// æ³¨æ„è¿™é‡Œçš„callerä¸º IApplicationThread</span></span><br><span class="line">    <span class="keyword">return</span> getActivityStartController().obtainStarter(intent, <span class="string">&quot;startActivityAsUser&quot;</span>)</span><br><span class="line">            .setCaller(caller)</span><br><span class="line">            .setCallingPackage(callingPackage)</span><br><span class="line">            .setCallingFeatureId(callingFeatureId)</span><br><span class="line">            .setResolvedType(resolvedType)</span><br><span class="line">            .setResultTo(resultTo)</span><br><span class="line">            .setResultWho(resultWho)</span><br><span class="line">            .setRequestCode(requestCode)</span><br><span class="line">            .setStartFlags(startFlags)</span><br><span class="line">            .setProfilerInfo(profilerInfo)</span><br><span class="line">            .setActivityOptions(bOptions)</span><br><span class="line">            .setUserId(userId)</span><br><span class="line">            .execute();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸»è¦é€šè¿‡å·¥å‚ç”Ÿäº§å‡ºActivityStarterå¯¹è±¡ï¼Œå¹¶è°ƒç”¨execute()æ‰§è¡Œã€‚</p>
<h4 id="ActivityStarter-execute"><a href="#ActivityStarter-execute" class="headerlink" title="ActivityStarter.execute()"></a>ActivityStarter.execute()</h4><p>ç”±è¯¥æ–¹æ³•æ³¨é‡Šæˆ‘ä»¬å¯çŸ¥å…¶ä½œç”¨ï¼š</p>
<blockquote>
<p>æ ¹æ®å‰é¢æä¾›çš„è¯·æ±‚å‚æ•°è§£æå¿…è¦çš„ä¿¡æ¯ï¼Œå¹¶æ‰§è¡Œå¼€å§‹å¯åŠ¨æ´»åŠ¨æ—…ç¨‹çš„è¯·æ±‚ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="meta">@link</span> com.android.server.wm.ActivityStarter&#125;</span><br><span class="line">&#123;<span class="meta">@link</span> &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// æ­¤å¤„çœç•¥ä»£ç </span></span><br><span class="line">        <span class="keyword">int</span> res;</span><br><span class="line">        <span class="keyword">synchronized</span> (mService.mGlobalLock) &#123;</span><br><span class="line">            <span class="comment">// æ­¤å¤„çœç•¥ä»£ç </span></span><br><span class="line">            res = executeRequest(mRequest);</span><br><span class="line"></span><br><span class="line">            Binder.restoreCallingIdentity(origId);</span><br><span class="line">            <span class="comment">// æ­¤å¤„çœç•¥ä»£ç </span></span><br><span class="line">            <span class="keyword">return</span> getExternalResult(mRequest.waitResult == <span class="keyword">null</span> ? res</span><br><span class="line">                    : waitForResult(res, mLastStartActivityRecord));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        onExecutionComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œè¿™ä¸ªæ–¹æ³•çš„æ ¸å¿ƒæ˜¯è°ƒç”¨<code>executeRequest(mRequest)</code>ï¼Œç”±äºä»£ç è¾ƒé•¿ï¼Œæ­¤å¤„çœç•¥å…·ä½“å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="meta">@link</span> com.android.server.wm.ActivityStarter&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">executeRequest</span><span class="params">(Request request)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// çœç•¥å…¶ä»–å®šä¹‰</span></span><br><span class="line">    <span class="keyword">final</span> IApplicationThread caller = request.caller;</span><br><span class="line">    <span class="keyword">final</span> IBinder resultTo = request.resultTo;</span><br><span class="line">    <span class="comment">// çœç•¥å…¶ä»–æ£€æŸ¥ä»£ç </span></span><br><span class="line">    <span class="comment">// æ£€æŸ¥æƒé™ç­‰</span></span><br><span class="line">    <span class="keyword">boolean</span> abort = !mSupervisor.checkStartAnyActivityPermission(intent, aInfo, resultWho,</span><br><span class="line">        requestCode, callingPid, callingUid, callingPackage, callingFeatureId,</span><br><span class="line">        request.ignoreTargetSecurity, inTask != <span class="keyword">null</span>, callerApp, resultRecord, resultStack);</span><br><span class="line">    abort |= !mService.mIntentFirewall.checkStartActivity(intent, callingUid,</span><br><span class="line">            callingPid, resolvedType, aInfo.applicationInfo);</span><br><span class="line">    abort |= !mService.getPermissionPolicyInternal().checkStartActivity(intent, callingUid,</span><br><span class="line">            callingPackage);</span><br><span class="line">    <span class="comment">// çœç•¥å…¶ä»–æ£€æŸ¥åŠè®¾ç½®çŠ¶æ€ä»£ç </span></span><br><span class="line">    <span class="comment">// åˆ›å»ºActivityRecordï¼Œæ³¨æ„æ­¤å¤„callerAppä¸º å¯¹ IApplicationThreadçš„å°è£…</span></span><br><span class="line">    <span class="keyword">final</span> ActivityRecord r = <span class="keyword">new</span> ActivityRecord(mService, callerApp, callingPid, callingUid,</span><br><span class="line">            callingPackage, callingFeatureId, intent, resolvedType, aInfo,</span><br><span class="line">            mService.getGlobalConfiguration(), resultRecord, resultWho, requestCode,</span><br><span class="line">            request.componentSpecified, voiceSession != <span class="keyword">null</span>, mSupervisor, checkedOptions,</span><br><span class="line">            sourceRecord);</span><br><span class="line">    mLastStartActivityRecord = r;</span><br><span class="line">    <span class="comment">// çœç•¥ä»£ç </span></span><br><span class="line">    mService.onStartActivitySetDidAppSwitch();</span><br><span class="line">    mController.doPendingActivityLaunches(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">    mLastStartActivityResult = startActivityUnchecked(r, sourceRecord, voiceSession,</span><br><span class="line">            request.voiceInteractor, startFlags, <span class="keyword">true</span> <span class="comment">/* doResume */</span>, checkedOptions, inTask,</span><br><span class="line">            restrictedBgActivity, intentGrants);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (request.outActivity != <span class="keyword">null</span>) &#123;</span><br><span class="line">        request.outActivity[<span class="number">0</span>] = mLastStartActivityRecord;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mLastStartActivityResult;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>executeRequest åšäº†åŸºæœ¬çš„å¯åŠ¨æ£€æŸ¥ï¼Œåˆ›å»ºåŒ…å«IApplicationThreadå¯¹è±¡çš„Activityçš„è¡¨ç¤ºç±»ActivityRecordï¼ˆå†å²å †æ ˆä¸­çš„ä¸€ä¸ªæ¡ç›®ï¼Œè¡¨ç¤ºä¸€ä¸ªæ´»åŠ¨ï¼‰ï¼Œå¹¶æœ€ç»ˆè°ƒç”¨ startActivityUnchecked() æ–¹æ³•ï¼ŒstartActivityUnchecked()ä¸­ä¸»è¦è°ƒç”¨ startActivityInner() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="meta">@link</span> com.android.server.wm.ActivityStarter&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">startActivityInner</span><span class="params">(<span class="keyword">final</span> ActivityRecord r, ActivityRecord sourceRecord,</span></span></span><br><span class="line"><span class="function"><span class="params">        IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> startFlags, <span class="keyword">boolean</span> doResume, ActivityOptions options, Task inTask,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">boolean</span> restrictedBgActivity, NeededUriGrants intentGrants)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// çœç•¥ä»£ç </span></span><br><span class="line">    <span class="comment">// è®¡ç®—æ˜¯å¦æœ‰ä¸€ä¸ªç°æœ‰çš„ä»»åŠ¡å¯ç”¨äºåŠ è½½Activityã€‚</span></span><br><span class="line">    <span class="keyword">final</span> Task targetTask = reusedTask != <span class="keyword">null</span> ? reusedTask : computeTargetTask();</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> newTask = targetTask == <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// çœç•¥ä»¥ä¸‹ä»£ç ï¼š</span></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹åˆ¤æ–­ä¸»è¦é’ˆå¯¹ç›®æ ‡Activity</span></span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦æ­£åœ¨æ ˆé¡¶</span></span><br><span class="line">    <span class="comment">// åˆ¤æ–­å¹¶æ‰§è¡Œæ˜¯å¦å¯ä»¥æ ˆé¡¶å¤ç”¨</span></span><br><span class="line">    <span class="comment">// åˆ¤æ–­å¹¶æ‰§è¡Œæ˜¯å¦éœ€è¦å¼€å¯æ–°æ ˆ</span></span><br><span class="line">    <span class="comment">// åˆ¤æ–­å¹¶æ‰§è¡Œæ˜¯å¦ç§»åŠ¨åˆ°æ ˆé¡¶ï¼ˆsingleTaskå¼¹æ ˆï¼‰</span></span><br><span class="line">    <span class="comment">// =====</span></span><br><span class="line">    <span class="comment">// æ“ä½œç›®æ ‡Activityæ ˆï¼Œå¯åŠ¨æ¨¡å¼ã€è½¬åœºåŠ¨ç”»ç›¸å…³é€»è¾‘</span></span><br><span class="line">    mTargetStack.startActivityLocked(mStartActivity, topStack.getTopNonFinishingActivity(),</span><br><span class="line">                newTask, mKeepCurTransition, mOptions);</span><br><span class="line">    <span class="keyword">if</span> (mDoResume) &#123;</span><br><span class="line">        <span class="keyword">final</span> ActivityRecord topTaskActivity =</span><br><span class="line">                mStartActivity.getTask().topRunningActivityLocked();</span><br><span class="line">        <span class="keyword">if</span> (!mTargetStack.isTopActivityFocusable()</span><br><span class="line">                || (topTaskActivity != <span class="keyword">null</span> &amp;&amp; topTaskActivity.isTaskOverlay()</span><br><span class="line">                &amp;&amp; mStartActivity != topTaskActivity)) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœè¯¥æ´»åŠ¨æ˜¯ä¸å¯è°ƒç„¦çš„ï¼Œæˆ‘ä»¬ä¸èƒ½æ¢å¤å®ƒï¼Œä½†ä»ç„¶å¸Œæœ›ç¡®ä¿å®ƒåœ¨å¼€å§‹æ—¶å¯è§(è¿™ä¹Ÿå°†è§¦å‘è¿›å…¥åŠ¨ç”»)ã€‚</span></span><br><span class="line">            <span class="comment">// è¿™æ–¹é¢çš„ä¸€ä¸ªä¾‹å­æ˜¯PIPæ´»åŠ¨ã€‚åŒæ ·ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›åœ¨ä¸€ä¸ªä»»åŠ¡ä¸­æ¢å¤å½“å‰æœ‰è¦†ç›–çš„æ´»åŠ¨ï¼Œå› ä¸ºå¼€å§‹çš„æ´»åŠ¨åªæ˜¯éœ€è¦åœ¨å¯è§çš„æš‚åœçŠ¶æ€ï¼Œç›´åˆ°è¦†ç›–è¢«åˆ é™¤ã€‚</span></span><br><span class="line">            <span class="comment">// ä¼ é€’&#123;@code null&#125;ä½œä¸ºstartå‚æ•°å¯ä»¥ç¡®ä¿æ‰€æœ‰æ´»åŠ¨éƒ½æ˜¯å¯è§çš„ã€‚</span></span><br><span class="line">            mTargetStack.ensureActivitiesVisible(<span class="keyword">null</span> <span class="comment">/* starting */</span>,</span><br><span class="line">                    <span class="number">0</span> <span class="comment">/* configChanges */</span>, !PRESERVE_WINDOWS);</span><br><span class="line">            <span class="comment">// ç»§ç»­å¹¶å‘Šè¯‰çª—å£ç®¡ç†å™¨ä¸ºè¿™ä¸ªæ´»åŠ¨æ‰§è¡Œåº”ç”¨ç¨‹åºè¿‡æ¸¡ï¼Œå› ä¸ºåº”ç”¨ç¨‹åºè¿‡æ¸¡ä¸ä¼šé€šè¿‡resumeé€šé“è§¦å‘ã€‚</span></span><br><span class="line">            mTargetStack.getDisplay().mDisplayContent.executeAppTransition();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœç›®æ ‡å †æ ˆä¹‹å‰ä¸æ˜¯å¯è°ƒç„¦çš„(è¯¥å †æ ˆä¸Šä¹‹å‰çš„topè¿è¡Œæ´»åŠ¨ä¸å¯è§)ï¼Œé‚£ä¹ˆä¹‹å‰ä»»ä½•å°†è¯¥å †æ ˆç§»åŠ¨åˆ°è¯¥å †æ ˆçš„è°ƒç”¨éƒ½ä¸ä¼šæ›´æ–°è¢«è°ƒç„¦çš„å †æ ˆã€‚</span></span><br><span class="line">            <span class="comment">// å¦‚æœç°åœ¨å¯åŠ¨æ–°çš„æ´»åŠ¨å…è®¸ä»»åŠ¡å †æ ˆå¯è°ƒç„¦ï¼Œé‚£ä¹ˆè¯·ç¡®ä¿æˆ‘ä»¬ç°åœ¨ç›¸åº”åœ°æ›´æ–°å·²è°ƒç„¦çš„å †æ ˆã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (mTargetStack.isTopActivityFocusable()</span><br><span class="line">                    &amp;&amp; !mRootWindowContainer.isTopDisplayFocusedStack(mTargetStack)) &#123;</span><br><span class="line">                mTargetStack.moveToFront(<span class="string">&quot;startActivityInner&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            mRootWindowContainer.resumeFocusedStacksTopActivities(</span><br><span class="line">                    mTargetStack, mStartActivity, mOptions);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     mRootWindowContainer.updateUserStack(mStartActivity.mUserId, mTargetStack);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“æ´»åŠ¨å¯åŠ¨æ—¶ï¼Œç«‹å³æ›´æ–°æœ€è¿‘ä»»åŠ¡åˆ—è¡¨</span></span><br><span class="line">    mSupervisor.mRecentTasks.add(mStartActivity.getTask());</span><br><span class="line">    mSupervisor.handleNonResizableTaskIfNeeded(mStartActivity.getTask(),</span><br><span class="line">            mPreferredWindowingMode, mPreferredTaskDisplayArea, mTargetStack);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> START_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äºè¿™é‡Œä»£ç è¾ƒé•¿ï¼Œæ•…å¿½ç•¥äº†å¤§é‡ä»£ç ï¼Œæˆ‘ä»¬å¯¹è¿™ä¸ªæ–¹æ³•çš„åŠŸèƒ½åšä¸€ä¸ªç®€å•çš„æ€»ç»“ï¼š</p>
<ul>
<li>æ ¹æ®å½“å‰æ ˆçš„æƒ…å†µï¼Œåˆ¤æ–­ç›®æ ‡Activityå…¥æ ˆæ“ä½œï¼šæ˜¯å¦éœ€è¦æ–°æ ˆï¼Œæ˜¯å¦æ ˆé¡¶å¤ç”¨ï¼Œæ˜¯å¦å¼¹æ ˆç­‰</li>
<li>è½¬åœºåŠ¨ç”»ç›¸å…³æ“ä½œ</li>
<li>åˆ¤æ–­ç›®æ ‡æ´»åŠ¨æ˜¯å¦å¯è·å¾—ç„¦ç‚¹ï¼Œæ‰§è¡Œå¯¹åº”æ“ä½œ</li>
</ul>
<p>é‚£ä¹ˆï¼Œåœ¨åˆ¤æ–­ç›®æ ‡æ´»åŠ¨æ˜¯å¦å¯è·å¾—ç„¦ç‚¹çš„åˆ†æ”¯é‡Œï¼Œæˆ‘ä»¬å¯åŠ¨çš„activityè‡ªç„¶æ˜¯éœ€è¦ç„¦ç‚¹ï¼ˆå¯è§å¯æ“ä½œï¼‰çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸»è¦å…³æ³¨<code>mRootWindowContainer.resumeFocusedStacksTopActivities(mTargetStack, mStartActivity, mOptions);</code>.</p>
<h4 id="RootWindowContainer-resumeFocusedStacksTopActivities"><a href="#RootWindowContainer-resumeFocusedStacksTopActivities" class="headerlink" title="RootWindowContainer.resumeFocusedStacksTopActivities()"></a>RootWindowContainer.resumeFocusedStacksTopActivities()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="meta">@link</span> com.android.server.wm.RootWindowContainer&#125;</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">resumeFocusedStacksTopActivities</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        ActivityStack targetStack, ActivityRecord target, ActivityOptions targetOptions)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!mStackSupervisor.readyToResume()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">// å¦‚æœç›®æ ‡åœ¨æ ˆé¡¶å±•ç¤ºåŒºåŸŸï¼Œåˆ™è°ƒç”¨ï¼ˆçŠ¶æ€æ¨¡å¼ï¼‰ResumeActivityItemæ‰§è¡Œresumeæ“ä½œ</span></span><br><span class="line">    <span class="keyword">if</span> (targetStack != <span class="keyword">null</span> &amp;&amp; (targetStack.isTopStackInDisplayArea()</span><br><span class="line">            || getTopDisplayFocusedStack() == targetStack)) &#123;</span><br><span class="line">        result = targetStack.resumeTopActivityUncheckedLocked(target, targetOptions);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> displayNdx = getChildCount() - <span class="number">1</span>; displayNdx &gt;= <span class="number">0</span>; --displayNdx) &#123;</span><br><span class="line">        <span class="comment">// çœç•¥å±•ç¤ºåŒºåŸŸç›¸å…³åˆ¤æ–­åŠè®¡ç®—</span></span><br><span class="line">        <span class="keyword">if</span> (!resumedOnDisplay) &#123;</span><br><span class="line">            <span class="comment">// åœ¨æ²¡æœ‰æœ‰æ•ˆæ´»åŠ¨çš„æƒ…å†µä¸‹(ä¾‹å¦‚ï¼Œè®¾å¤‡åˆšåˆšå¯åŠ¨æˆ–å¯åŠ¨ç¨‹åºå´©æºƒ)ï¼Œå¯èƒ½ä»€ä¹ˆéƒ½æ²¡æœ‰æ¢å¤æ˜¾ç¤ºã€‚</span></span><br><span class="line">            <span class="comment">// æ˜¾å¼åœ°è¯·æ±‚é›†ä¸­å †æ ˆä¸­çš„topæ´»åŠ¨çš„resumeå°†ç¡®ä¿è‡³å°‘homeæ´»åŠ¨è¢«å¯åŠ¨å’Œæ¢å¤ï¼Œå¹¶ä¸”ä¸ä¼šå‘ç”Ÿé€’å½’ã€‚</span></span><br><span class="line">            <span class="keyword">final</span> ActivityStack focusedStack = display.getFocusedStack();</span><br><span class="line">            <span class="keyword">if</span> (focusedStack != <span class="keyword">null</span>) &#123;</span><br><span class="line">                result |= focusedStack.resumeTopActivityUncheckedLocked(target, targetOptions);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (targetStack == <span class="keyword">null</span>) &#123;</span><br><span class="line">                result |= resumeHomeActivity(<span class="keyword">null</span> <span class="comment">/* prev */</span>, <span class="string">&quot;no-focusable-task&quot;</span>,</span><br><span class="line">                        display.getDefaultTaskDisplayArea());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§‚å¯Ÿä¸Šè¿°ä»£ç ï¼Œä¸»è¦åšäº†ä»¥ä¸‹äº‹æƒ…ï¼š</p>
<ul>
<li>å¦‚æœç›®æ ‡å·²å±•ç¤ºåœ¨æ ˆé¡¶å¯è§åŒºåŸŸï¼Œåˆ™æ‰§è¡Œresume</li>
<li>å¦‚æœä¸å­˜åœ¨æœ‰æ•ˆçš„æ´»åŠ¨ï¼ˆå´©æºƒæˆ–é¦–æ¬¡å¯åŠ¨ï¼‰ï¼Œåˆ™å¯åŠ¨é¦–é¡µ</li>
<li>å¦‚æœå­˜åœ¨æœ‰æ•ˆæ´»åŠ¨ï¼ˆå­˜åœ¨æœ‰ç„¦ç‚¹çš„æ ˆï¼‰ï¼Œç»§ç»­æ‰§è¡Œå¯åŠ¨æµç¨‹</li>
</ul>
<p>æ­¤å¤„ï¼Œæˆ‘ä»¬ä»¥å­˜åœ¨æœ‰æ•ˆæ´»åŠ¨ä¸ºæ¡ä»¶ï¼Œç»§ç»­å…³æ³¨å¯åŠ¨æµç¨‹ï¼Œè·Ÿè¿›resumeTopActivityUncheckedLocked()ï¼›</p>
<h4 id="ActivityStack-resumeTopActivityUncheckedLocked"><a href="#ActivityStack-resumeTopActivityUncheckedLocked" class="headerlink" title="ActivityStack.resumeTopActivityUncheckedLocked()"></a>ActivityStack.resumeTopActivityUncheckedLocked()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="meta">@link</span> com.android.server.wm.ActivityStack&#125;</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">resumeTopActivityUncheckedLocked</span><span class="params">(ActivityRecord prev, ActivityOptions options)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mInResumeTopActivity) &#123;</span><br><span class="line">        <span class="comment">// ï¼ˆå¦‚æœåœ¨æ ˆé¡¶å¯è§ï¼‰,ç”šè‡³ä¸è¦å¼€å§‹é€’å½’.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// é˜²æ­¢é€’å½’ã€‚</span></span><br><span class="line">        mInResumeTopActivity = <span class="keyword">true</span>;</span><br><span class="line">        result = resumeTopActivityInnerLocked(prev, options);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“æ¢å¤topæ´»åŠ¨æ—¶ï¼Œå¯èƒ½éœ€è¦æš‚åœtopæ´»åŠ¨(ä¾‹å¦‚ï¼Œè¿”å›é”å±ã€‚</span></span><br><span class="line">        <span class="comment">// æˆ‘ä»¬åœ¨&#123;@link #resumeTopActivityUncheckedLocked&#125;ä¸­å–æ¶ˆäº†æ­£å¸¸çš„æš‚åœé€»è¾‘ï¼Œå› ä¸ºé¡¶éƒ¨æ´»åŠ¨åœ¨ç»“æŸæ—¶æ¢å¤ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œå†æ¬¡è°ƒç”¨&#123;@link ActivityStackSupervisor# checkreadyforsleepplocked&#125;æ¥ç¡®ä¿ä»»ä½•å¿…è¦çš„æš‚åœé€»è¾‘å‘ç”Ÿã€‚</span></span><br><span class="line">        <span class="comment">// åœ¨ä¸è€ƒè™‘é”å±çš„æƒ…å†µä¸‹ï¼Œæ´»åŠ¨å°†è¢«æ˜¾ç¤ºï¼Œå¯¹&#123;@link ActivityStackSupervisor# checkreadyforsleepplocked&#125;çš„è°ƒç”¨è¢«è·³è¿‡ã€‚</span></span><br><span class="line">        <span class="keyword">final</span> ActivityRecord next = topRunningActivity(<span class="keyword">true</span> <span class="comment">/* focusableOnly */</span>);</span><br><span class="line">        <span class="keyword">if</span> (next == <span class="keyword">null</span> || !next.canTurnScreenOn()) &#123;</span><br><span class="line">            checkReadyForSleep();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        mInResumeTopActivity = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§‚å¯Ÿä»£ç ï¼Œè¿™é‡Œä¸»è¦åšäº†é˜²æ­¢é€’å½’è°ƒç”¨çš„æªæ–½ï¼Œä»¥åŠè°ƒç”¨äº†resumeTopActivityInnerLocked()æ–¹æ³•ï¼Œä»£ç è¾ƒé•¿ï¼Œæ­¤å¤„å°†åšå¿½ç•¥å’Œæ‹†è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="meta">@link</span> com.android.server.wm.ActivityStack&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">resumeTopActivityInnerLocked</span><span class="params">(ActivityRecord prev, ActivityOptions options)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¿½ç•¥éƒ¨åˆ†åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (!hasRunningActivity) &#123;</span><br><span class="line">        <span class="comment">// æ ˆé‡Œæ²¡æœ‰æ´»åŠ¨äº†ï¼Œæˆ‘ä»¬å»åˆ«çš„åœ°æ–¹çœ‹çœ‹ã€‚</span></span><br><span class="line">        <span class="comment">// å¤‡æ³¨ï¼šæ³¨æ„ï¼Œæ­¤å¤„å¯èƒ½ä¼šå‡ºç°é€’å½’è°ƒç”¨ï¼Œå³ä¼šè°ƒç”¨å‰é¢çš„æµç¨‹ï¼šRootWindowContainer.resumeFocusedStacksTopActivities()</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œä¹Ÿæ˜¯å‰åºæµç¨‹ä¸­é˜²èŒƒé€’å½’çš„åŸå› </span></span><br><span class="line">        <span class="keyword">return</span> resumeNextFocusableActivityWhenStackIsEmpty(prev, options);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// çœç•¥å¤§é‡ä»£ç </span></span><br><span class="line">    <span class="comment">// æ‰§è¡Œæ ˆä¸­å…¶ä»–activityçš„pauseæ“ä½œ</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬æ­£åœ¨å¯åŠ¨ä¸‹ä¸€ä¸ªæ´»åŠ¨ï¼Œå› æ­¤å‘Šè¯‰çª—å£ç®¡ç†å™¨å‰ä¸€ä¸ªæ´»åŠ¨å°†å¾ˆå¿«è¢«éšè—ã€‚è¿™æ ·å®ƒå°±å¯ä»¥çŸ¥é“åœ¨è®¡ç®—æ‰€éœ€çš„å±å¹•æ–¹å‘æ—¶å¿½ç•¥å®ƒã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (next.attachedToProcess()) &#123;</span><br><span class="line">    <span class="comment">// æ›´æ–°è¿›ç¨‹ä¿¡æ¯</span></span><br><span class="line">    <span class="comment">// æ£€æŸ¥ç‰¹æ®Šåœºæ™¯ï¼Œä¾‹å¦‚åŠé€æ˜Activityç­‰</span></span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å“å‘€ï¼Œéœ€è¦é‡æ–°å¯åŠ¨è¿™ä¸ªActivity!</span></span><br><span class="line">        <span class="keyword">if</span> (!next.hasBeenLaunched) &#123;</span><br><span class="line">            next.hasBeenLaunched = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (SHOW_APP_STARTING_PREVIEW) &#123;</span><br><span class="line">                next.showStartingWindow(<span class="keyword">null</span> <span class="comment">/* prev */</span>, <span class="keyword">false</span> <span class="comment">/* newTask */</span>,</span><br><span class="line">                        <span class="keyword">false</span> <span class="comment">/* taskSwich */</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (DEBUG_SWITCH) Slog.v(TAG_SWITCH, <span class="string">&quot;Restarting: &quot;</span> + next);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (DEBUG_STATES) Slog.d(TAG_STATES, <span class="string">&quot;resumeTopActivityLocked: Restarting &quot;</span> + next);</span><br><span class="line">        mStackSupervisor.startSpecificActivity(next, <span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç æ¯”è¾ƒé•¿ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†çš„æ“ä½œåœ¨ä¸Šè¿°ä»£ç çš„æ³¨é‡Šä¸­æœ‰è¯´æ˜ï¼Œæ­¤å¤„ä¸åšè¿‡å¤šå…³æ³¨ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸startActivity()æœ‰å…³çš„ä»£ç ä¸º<code>mStackSupervisor.startSpecificActivity(next, true, true)</code>, æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆã€‚</p>
<h4 id="ActivityStackSupervisor-startSpecificActivity"><a href="#ActivityStackSupervisor-startSpecificActivity" class="headerlink" title="ActivityStackSupervisor.startSpecificActivity()"></a>ActivityStackSupervisor.startSpecificActivity()</h4><p>Supervisor ï¼šä¸»ç®¡ã€‚è¿™ä¸ªç±»å­—é¢æ„æ€æ˜¯æ´»åŠ¨æ ˆçš„ä¸»ç®¡ï¼Œå®ƒçš„ä½œç”¨ä»æ³¨é‡Šä¸­å¯ä»¥äº†è§£åˆ°ï¼š</p>
<blockquote>
<ul>
<li>å°†ä¸å±‚æ¬¡ç»“æ„ç›¸å…³çš„ä¸œè¥¿ç§»åŠ¨åˆ°RootWindowContainer</li>
<li>å°†ä¸æ´»åŠ¨ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„ä¸œè¥¿ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°çš„ç±»ActivityLifeCyclerä¸­</li>
<li>ç§»åŠ¨æ¥å£äº‹ç‰©åˆ°ActivityTaskManagerServiceã€‚</li>
<li>æ‰€æœ‰å…¶ä»–çš„å°äº‹æƒ…åˆ°å…¶ä»–æ–‡ä»¶ã€‚</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">void startSpecificActivity(ActivityRecord r, boolean andResume, boolean checkConfig) &#123;</span><br><span class="line">    &#x2F;&#x2F; Is this activity&#39;s application already running?</span><br><span class="line">    &#x2F;&#x2F; çœŸæ˜¯ä¸ªç³Ÿç³•çš„æ³¨é‡Šï¼Œè®©æˆ‘æƒ³èµ·äº†å¶å°”ä¼šé‡åˆ°çš„ä¸€ä¸ªæŠ¥é”™  â”—|ï½€Oâ€²|â”›</span><br><span class="line">    final WindowProcessController wpc &#x3D;</span><br><span class="line">            mService.getProcessController(r.processName, r.info.applicationInfo.uid);</span><br><span class="line"></span><br><span class="line">    boolean knownToBeDead &#x3D; false;</span><br><span class="line">    &#x2F;&#x2F; å¦‚æœapplicationThreadå­˜åœ¨ï¼Œåˆ™æ‰§è¡ŒçœŸå®çš„å¯åŠ¨Activity</span><br><span class="line">    if (wpc !&#x3D; null &amp;&amp; wpc.hasThread()) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            realStartActivityLocked(r, wpc, andResume, checkConfig);</span><br><span class="line">            return;</span><br><span class="line">        &#125; catch (RemoteException e) &#123;</span><br><span class="line">            Slog.w(TAG, &quot;Exception when starting activity &quot;</span><br><span class="line">                    + r.intent.getComponent().flattenToShortString(), e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; å¦‚æœæŠ›å‡ºäº†æ­»å¯¹è±¡å¼‚å¸¸â€”â€”é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºã€‚</span><br><span class="line">        knownToBeDead &#x3D; true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r.notifyUnknownVisibilityLaunchedForKeyguardTransition();</span><br><span class="line"></span><br><span class="line">    final boolean isTop &#x3D; andResume &amp;&amp; r.isTopRunningActivity();</span><br><span class="line">    &#x2F;&#x2F; è‹¥applicationThreadä¸å­˜åœ¨ï¼Œå°†å¯åŠ¨æ–°çš„è¿›ç¨‹</span><br><span class="line">    mService.startProcessAsync(r, knownToBeDead, isTop, isTop ? &quot;top-activity&quot; : &quot;activity&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œä¸»è¦åšäº†ä¸‰æ¬¡æ ¡éªŒï¼š</p>
<ul>
<li>è‹¥ç›®æ ‡ApplicationThreadå¯¹è±¡å­˜åœ¨ï¼Œåˆ™ç»§ç»­æ‰§è¡Œå¯åŠ¨æµç¨‹</li>
<li>è‹¥å¯åŠ¨æµç¨‹æ‰§è¡Œå¤±è´¥ï¼Œåˆ™é‡å¯åº”ç”¨ç¨‹åº</li>
<li>è‹¥ç›®æ ‡ApplicationThreadå¯¹è±¡ä¸å­˜åœ¨ï¼Œåˆ™å¯åŠ¨æ–°çš„è¿›ç¨‹ï¼›æ­¤æµç¨‹æš‚ä¸åšå…³æ³¨ï¼Œå¯è‡ªè¡Œè·Ÿè¿›ï¼Œæœ€ç»ˆä¼šè°ƒç”¨ActivityManagerService.startProcessLocked()åŠåç»­ZygoteProcessç›¸å…³æ–¹æ³•ã€‚</li>
</ul>
<h4 id="ActivityStackSupervisor-realStartActivityLocked"><a href="#ActivityStackSupervisor-realStartActivityLocked" class="headerlink" title="ActivityStackSupervisor.realStartActivityLocked()"></a>ActivityStackSupervisor.realStartActivityLocked()</h4><p>ActivityStackSupervisor.realStartActivityLocked()åŸºæœ¬ç®—å¾—ä¸Šå¯åŠ¨æµç¨‹ä¸­ç›¸å½“é‡è¦çš„ä¸€éƒ¨åˆ†äº†ï¼ŒåŸºæœ¬ç®—å¾—ä¸Šæ˜¯è°ƒç”¨é“¾çš„ç»“æŸï¼Œåç»­å°†æ‰§è¡Œç›®æ ‡ActivityThreadæ‰§è¡ŒLaunchæ“ä½œï¼Œæ•…å•ç‹¬åšä¸€å°èŠ‚è®²è¿°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="meta">@link</span> com.android.server.wm.ActivityStackSupervisor&#125;</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">realStartActivityLocked</span><span class="params">(ActivityRecord r, WindowProcessController proc,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">boolean</span> andResume, <span class="keyword">boolean</span> checkConfig)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!mRootWindowContainer.allPausedActivitiesComplete()) &#123;</span><br><span class="line">        <span class="comment">// å½“æœ‰æ´»åŠ¨æš‚åœæ—¶ï¼Œæˆ‘ä»¬è·³è¿‡å¼€å§‹ä»»ä½•æ–°çš„æ´»åŠ¨ï¼Œç›´åˆ°æš‚åœå®Œæˆã€‚</span></span><br><span class="line">        <span class="comment">// æ³¨æ„:å¯¹äºåœ¨æš‚åœçŠ¶æ€ä¸‹å¯åŠ¨çš„æ´»åŠ¨ï¼Œæˆ‘ä»¬ä¹Ÿä¼šè¿™æ ·åšï¼Œå› ä¸ºå®ƒä»¬é¦–å…ˆä¼šè¢«æ¢å¤ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯æš‚åœã€‚</span></span><br><span class="line">        <span class="comment">// æ€è€ƒï¼šé‚£ä¹ˆï¼Œä½ ä¼šæ‹…å¿ƒå½“æ­¤å¯åŠ¨æœªæˆåŠŸå—ï¼Ÿå¯è¿˜è®°å¾—ã€‚æˆ‘ä»¬å¯åŠ¨æµç¨‹å…¶å®åŒ…å«é€’å½’æ“ä½œï¼Œå¦‚æœæ­¤æ¬¡ä¸­æ–­ï¼Œä¸ä»£è¡¨åç»­å°±ä¸å†æ‰§è¡Œå¯åŠ¨æ“ä½œäº†ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (DEBUG_SWITCH || DEBUG_PAUSE || DEBUG_STATES) Slog.v(TAG_PAUSE,</span><br><span class="line">                <span class="string">&quot;realStartActivityLocked: Skipping start of r=&quot;</span> + r</span><br><span class="line">                + <span class="string">&quot; some activities pausing...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çœç•¥å¤§é‡ä»£ç     </span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å› ä¸ºæˆ‘ä»¬å¯èƒ½ä¼šåœ¨ç³»ç»Ÿè¿›ç¨‹ä¸­å¯åŠ¨ä¸€ä¸ªæ´»åŠ¨ï¼Œæ‰€ä»¥è¿™å¯èƒ½ä¸ä¼šè·¨è¶Šåˆ›å»ºæ–°é…ç½®çš„ç»‘å®šå™¨æ¥å£ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»æ€»æ˜¯åœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ªæ–°çš„é…ç½®ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> MergedConfiguration mergedConfiguration = <span class="keyword">new</span> MergedConfiguration(</span><br><span class="line">            proc.getConfiguration(), r.getMergedOverrideConfiguration());</span><br><span class="line">    r.setLastReportedConfiguration(mergedConfiguration);</span><br><span class="line"></span><br><span class="line">    logIfTransactionTooLarge(r.intent, r.getSavedState());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºæ´»åŠ¨å¯åŠ¨äº‹åŠ¡ã€‚</span></span><br><span class="line">    <span class="keyword">final</span> ClientTransaction clientTransaction = ClientTransaction.obtain(</span><br><span class="line">            proc.getThread(), r.appToken);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> DisplayContent dc = r.getDisplay().mDisplayContent;</span><br><span class="line">    clientTransaction.addCallback(LaunchActivityItem.obtain(<span class="keyword">new</span> Intent(r.intent),</span><br><span class="line">            System.identityHashCode(r), r.info,</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Have this take the merged configuration instead of separate global</span></span><br><span class="line">            <span class="comment">// and override configs.</span></span><br><span class="line">            mergedConfiguration.getGlobalConfiguration(),</span><br><span class="line">            mergedConfiguration.getOverrideConfiguration(), r.compat,</span><br><span class="line">            r.launchedFromPackage, task.voiceInteractor, proc.getReportedProcState(),</span><br><span class="line">            r.getSavedState(), r.getPersistentSavedState(), results, newIntents,</span><br><span class="line">            dc.isNextTransitionForward(), proc.createProfilerInfoIfNeeded(),</span><br><span class="line">            r.assistToken, r.createFixedRotationAdjustmentsIfNeeded()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set desired final state.</span></span><br><span class="line">    <span class="keyword">final</span> ActivityLifecycleItem lifecycleItem;</span><br><span class="line">    <span class="keyword">if</span> (andResume) &#123;</span><br><span class="line">        lifecycleItem = ResumeActivityItem.obtain(dc.isNextTransitionForward());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        lifecycleItem = PauseActivityItem.obtain();</span><br><span class="line">    &#125;</span><br><span class="line">    clientTransaction.setLifecycleStateRequest(lifecycleItem);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Schedule transaction.</span></span><br><span class="line">    mService.getLifecycleManager().scheduleTransaction(clientTransaction);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å†æ¬¡çœç•¥å¤§é‡ä»£ç </span></span><br><span class="line">    <span class="comment">// è®¾ç½®æ´»åŠ¨çŠ¶æ€åï¼Œæ‰§è¡ŒOOMè¯„åˆ†ï¼Œä½¿æµç¨‹å¯ä»¥æ›´æ–°ä¸ºæœ€æ–°çŠ¶æ€ã€‚    </span></span><br><span class="line">    proc.onStartActivity(mService.mTopProcessState, r.info);</span><br><span class="line">    <span class="comment">//å¦‚æœéœ€è¦ï¼Œå¯åŠ¨æ–°ç‰ˆæœ¬è®¾ç½®å±å¹•ã€‚æˆ‘ä»¬åœ¨å¯åŠ¨åˆå§‹åŒ–çš„activity(å³home)ä¹‹ååšè¿™ä¸ªæ“ä½œï¼Œè¿™æ ·å®ƒå°±æœ‰æœºä¼šåœ¨åå°åˆå§‹åŒ–è‡ªå·±ï¼Œä½¿åˆ‡æ¢å›å®ƒæ›´å¿«ï¼Œçœ‹èµ·æ¥æ›´å¥½ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (mRootWindowContainer.isTopDisplayFocusedStack(stack)) &#123;</span><br><span class="line">        mService.getActivityStartController().startSetupActivity();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ›´æ–°æˆ‘ä»¬ç»‘å®šåˆ°çš„ä»»ä½•å¯èƒ½å…³å¿ƒå…¶å®¢æˆ·ç«¯æ˜¯å¦æœ‰æ´»åŠ¨çš„æœåŠ¡ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (r.app != <span class="keyword">null</span>) &#123;</span><br><span class="line">        r.app.updateServiceConnectionActivities();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šè¿°ä»£ç åŠæ³¨é‡Šæˆ‘ä»¬å¯çŸ¥ï¼ŒrealStartActivityLockedçš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼š</p>
<ul>
<li>è‹¥æœ‰æ­£åœ¨pauseçš„æ´»åŠ¨ï¼Œç­‰å¾…å®ƒæ“ä½œå®Œæ¯•</li>
<li>åˆ›å»º LaunchActivityItem ï¼ˆå¯åŠ¨Activityçš„ç­–ç•¥/çŠ¶æ€ï¼‰å¹¶å°è£…æˆäº‹åŠ¡</li>
<li>æ‰§è¡Œå¯åŠ¨Activityçš„äº‹åŠ¡</li>
<li>æ›´æ–°è¿›ç¨‹ä¿¡æ¯åŠå…¶ä»–ç›¸å…³æœåŠ¡</li>
</ul>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬çŸ¥é“activityå¯åŠ¨æµç¨‹çš„æœ€åä¸¤æ­¥å³æ˜¯ï¼šåˆ›å»º LaunchActivityItem åŠæ‰§è¡Œ ClientTransactionï¼Œè¿™é‡Œæˆ‘ä»¬åˆ†ä¸¤å„éƒ¨åˆ†ä»‹ç»ï¼Œå…ˆä»‹ç» ClientTransaction çš„è°ƒç”¨æµç¨‹ï¼Œå†ä»‹ç» LaunchActivityItem æ˜¯ä»€ä¹ˆã€‚</p>
<h4 id="æ‰§è¡ŒLaunchActivityItemäº‹åŠ¡"><a href="#æ‰§è¡ŒLaunchActivityItemäº‹åŠ¡" class="headerlink" title="æ‰§è¡ŒLaunchActivityItemäº‹åŠ¡"></a>æ‰§è¡ŒLaunchActivityItemäº‹åŠ¡</h4><p>ActivityStackSupervisor.realStartActivityLocked()ä¸­è°ƒç”¨çš„<code>mService.getLifecycleManager().scheduleTransaction(clientTransaction);</code>å®é™…æ˜¯ClientLifecycleManager.scheduleTransaction()ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="meta">@link</span> com.android.server.wm.ClientLifecycleManager&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">scheduleTransaction</span><span class="params">(ClientTransaction transaction)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> IApplicationThread client = transaction.getClient();</span><br><span class="line">    transaction.schedule();</span><br><span class="line">    <span class="keyword">if</span> (!(client <span class="keyword">instanceof</span> Binder)) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœclientä¸æ˜¯Binderçš„å®ä¾‹â€”â€”å®ƒæ˜¯ä¸€ä¸ªè¿œç¨‹è°ƒç”¨ï¼Œæ­¤æ—¶å¯ä»¥å®‰å…¨åœ°å›æ”¶å¯¹è±¡ã€‚</span></span><br><span class="line">        <span class="comment">// åœ¨ActivityThreadçš„å®¢æˆ·ç«¯ä¸Šæ‰§è¡Œäº‹åŠ¡åï¼Œç”¨äºæœ¬åœ°è°ƒç”¨çš„æ‰€æœ‰å¯¹è±¡éƒ½å°†è¢«å›æ”¶ã€‚</span></span><br><span class="line">        transaction.recycle();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸»è¦è°ƒç”¨äº†<code>ClientTransaction.schedule()</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="meta">@link</span> android.app.servertransaction.ClientTransaction&#125;</span><br><span class="line"><span class="comment">/** Target client. */</span></span><br><span class="line"><span class="keyword">private</span> IApplicationThread mClient;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">schedule</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">    mClient.scheduleTransaction(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±ä»£ç å¯çŸ¥ï¼Œè¿™é‡Œè°ƒç”¨äº†IApplicationThread.scheduleTransaction()ã€‚è¿™é‡Œçš„IApplicationThreadæ¥æºäºClientTransaction.obtain()å…¥å‚ï¼Œå‘å‰è¿½æº¯åˆ™æ˜¯é€šè¿‡ActivityRecorderè·å–çš„ï¼Œå®é™…æ˜¯å‰è¿°å¯åŠ¨æµç¨‹ä¸­ä¼ é€’çš„callerã€æ­¤å¤„æè¿°å¯èƒ½ä¸å¤Ÿä¸¥è°¨ï¼Œå¦‚æœ‰é”™è¯¯è¯·è¯„è®ºæˆ–è”ç³»ä½œè€…ã€‘ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬é¦–å…ˆåº”è¯¥æ‰¾åˆ° IApplicationThreadçš„å®ç°ï¼Œå¦‚æœä½ å¯¹ActivityThreadæœ‰ä¸€å®šäº†è§£çš„è¯ï¼Œå¯ä»¥çŸ¥é“å…¶å†…éƒ¨ç±» ApplicationThread å®ç°äº† IApplicationThread.Stubï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#123;@link android.app.ActivityThread&#125;</span><br><span class="line"></span><br><span class="line">public final class ActivityThread extends ClientTransactionHandler &#123;</span><br><span class="line"></span><br><span class="line">    private class ApplicationThread extends IApplicationThread.Stub &#123;</span><br><span class="line">        &#x2F;&#x2F; å¿½ç•¥å…¶ä»–ä»£ç </span><br><span class="line">        @Override</span><br><span class="line">        public void scheduleTransaction(ClientTransaction transaction) throws RemoteException &#123;</span><br><span class="line">            ActivityThread.this.scheduleTransaction(transaction);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public abstract class ClientTransactionHandler &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Schedule phase related logic and handlers.</span><br><span class="line"></span><br><span class="line">    &#x2F;** Prepare and schedule transaction for execution. *&#x2F;</span><br><span class="line">    void scheduleTransaction(ClientTransaction transaction) &#123;</span><br><span class="line">        transaction.preExecute(this);</span><br><span class="line">        sendMessage(ActivityThread.H.EXECUTE_TRANSACTION, transaction);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  class H extends Handler &#123;</span><br><span class="line">      </span><br><span class="line">      public void handleMessage(Message msg) &#123;</span><br><span class="line">            switch (msg.what) &#123;</span><br><span class="line">                case EXECUTE_TRANSACTION:</span><br><span class="line">                    final ClientTransaction transaction &#x3D; (ClientTransaction) msg.obj;</span><br><span class="line">                    mTransactionExecutor.execute(transaction);</span><br><span class="line">                    if (isSystem()) &#123;</span><br><span class="line">                        &#x2F;&#x2F; ç³»ç»Ÿè¿›ç¨‹å†…éƒ¨çš„å®¢æˆ·ç«¯äº‹åŠ¡åœ¨å®¢æˆ·ç«¯å¾ªç¯ï¼Œè€Œä¸æ˜¯åœ¨ClientLifecycleManagerä¸­å¾ªç¯ï¼Œä»¥é¿å…åœ¨æ­¤æ¶ˆæ¯è¢«å¤„ç†ä¹‹å‰è¢«æ¸…é™¤ã€‚</span><br><span class="line">                        transaction.recycle();</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#x2F;&#x2F; TODO(lifecycler): Recycle locally scheduled transactions.</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆï¼Œè°ƒç”¨IApplicationThread.scheduleTransaction()ï¼Œå®é™…ä¸Šæ˜¯å‘ActivityThread.Hå‘é€äº†Messageï¼Œè€ŒåActivityThread.Hå¤„ç†æ¶ˆæ¯å¹¶è°ƒç”¨äº†<code>mTransactionExecutor.execute(transaction)</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="meta">@link</span> android.app.servertransaction.TransactionExecutor&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(ClientTransaction transaction)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¿½ç•¥ä»£ç </span></span><br><span class="line"></span><br><span class="line">    executeCallbacks(transaction);</span><br><span class="line"></span><br><span class="line">    executeLifecycleState(transaction);</span><br><span class="line">    mPendingActions.clear();</span><br><span class="line">    <span class="keyword">if</span> (DEBUG_RESOLVER) Slog.d(TAG, tId(transaction) + <span class="string">&quot;End resolving transaction&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Cycle through all states requested by callbacks and execute them at proper times. */</span></span><br><span class="line"><span class="meta">@VisibleForTesting</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">executeCallbacks</span><span class="params">(ClientTransaction transaction)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¿½ç•¥ä»£ç </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> size = callbacks.size();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; ++i) &#123;</span><br><span class="line">        <span class="keyword">final</span> ClientTransactionItem item = callbacks.get(i);</span><br><span class="line">        <span class="comment">// å¿½ç•¥ä»£ç </span></span><br><span class="line"></span><br><span class="line">        item.execute(mTransactionHandler, token, mPendingActions);</span><br><span class="line">        item.postExecute(mTransactionHandler, token, mPendingActions);</span><br><span class="line">        <span class="comment">// å¿½ç•¥ä»£ç </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TransactionExecutor.execute()åŠåç»­executeCallbacks()æœ€ç»ˆè°ƒç”¨åˆ°äº† BaseClientRequest.execute()ï¼Œä¹Ÿå°±æ˜¯LaunchActivityItem.execute()ã€‚</p>
<h4 id="LaunchActivityItem"><a href="#LaunchActivityItem" class="headerlink" title="LaunchActivityItem"></a>LaunchActivityItem</h4><p>åœ¨Android API 29åŠä»¥ä¸ŠSDKä¸­ï¼ŒGoogleå°†å¯ä»¥è°ƒåº¦å’Œæ‰§è¡Œçš„åˆ°å®¢æˆ·ç«¯çš„å›è°ƒæ¶ˆæ¯å°è£…ä¸ºäº‹åŠ¡ï¼ŒåŒ…å«Launchã€Startã€Stopç­‰å„ç§çŠ¶æ€ã€‚</p>
<p>ç»§æ‰¿è‡ª ClientTransactionItem åŠä¸Šå±‚ BaseClientRequestï¼Œæ ¸å¿ƒæ–¹æ³•ä¸ºexecute(ClientTransactionHandler client, IBinder token, PendingTransactionActions pendingActions)ï¼Œå·²çŸ¥çš„ClientTransactionHandler æœ‰ActivityThreadã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="meta">@link</span> android.app.servertransaction.LaunchActivityItem&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(ClientTransactionHandler client, IBinder token,</span></span></span><br><span class="line"><span class="function"><span class="params">        PendingTransactionActions pendingActions)</span> </span>&#123;</span><br><span class="line">    Trace.traceBegin(TRACE_TAG_ACTIVITY_MANAGER, <span class="string">&quot;activityStart&quot;</span>);</span><br><span class="line">    ActivityClientRecord r = <span class="keyword">new</span> ActivityClientRecord(token, mIntent, mIdent, mInfo,</span><br><span class="line">            mOverrideConfig, mCompatInfo, mReferrer, mVoiceInteractor, mState, mPersistentState,</span><br><span class="line">            mPendingResults, mPendingNewIntents, mIsForward,</span><br><span class="line">            mProfilerInfo, client, mAssistToken, mFixedRotationAdjustments);</span><br><span class="line">    client.handleLaunchActivity(r, pendingActions, <span class="keyword">null</span> <span class="comment">/* customIntent */</span>);</span><br><span class="line">    Trace.traceEnd(TRACE_TAG_ACTIVITY_MANAGER);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>LaunchActivityItem.execute()ä¸­ä¸»è¦è°ƒç”¨äº†<code>client.handleLaunchActivity(r, pendingActions, null /* customIntent */)</code>ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨äº†ActivityThreadçš„ç›¸å…³æ–¹æ³•ã€‚</p>
<p>å½“ç„¶çš„ActivityThread.handleLaunchActivity() å°±æ˜¯å®é™…çš„æ–°çš„Activityä»åˆ›å»ºåˆ°å±•ç¤ºçš„æµç¨‹äº†ã€‚</p>
<p>è‡³æ­¤ï¼Œå…¶å®æ•´ä¸ªä» startActivityçš„è°ƒç”¨åˆ°ç›®æ ‡Activityåˆ›å»ºçš„è°ƒç”¨æµç¨‹å°±å·²ç»åˆ†æå®Œæ¯•äº†ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬æ¥ç”»ä¸€ç”»æ•´ä¸ªæµç¨‹çš„æ—¶åºå›¾ã€‚</p>
<p>ã€æ—¶åºå›¾è¿˜åœ¨ç”»ï¼Œè§‚ä¼—è€çˆ·è¯·ç¨å€™ã€‘</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Activity/" rel="tag"># Activity</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/04/04/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8B%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96/" rel="prev" title="æ€§èƒ½ä¼˜åŒ–ä¹‹å†…å­˜ä¼˜åŒ–">
      <i class="fa fa-chevron-left"></i> æ€§èƒ½ä¼˜åŒ–ä¹‹å†…å­˜ä¼˜åŒ–
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">2.</span> <span class="nav-text">æºç åˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Activity-startActivity"><span class="nav-number">2.1.</span> <span class="nav-text">Activity.startActivity()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Activity-startActivityForResult"><span class="nav-number">2.2.</span> <span class="nav-text">Activity.startActivityForResult()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Instrumentation-execStartActivity"><span class="nav-number">2.3.</span> <span class="nav-text">Instrumentation.execStartActivity()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ActivityTaskManager-getService"><span class="nav-number">2.4.</span> <span class="nav-text">ActivityTaskManager.getService()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IActivityTaskManager-startActivity"><span class="nav-number">2.5.</span> <span class="nav-text">IActivityTaskManager.startActivity()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ActivityStarter-execute"><span class="nav-number">2.6.</span> <span class="nav-text">ActivityStarter.execute()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RootWindowContainer-resumeFocusedStacksTopActivities"><span class="nav-number">2.7.</span> <span class="nav-text">RootWindowContainer.resumeFocusedStacksTopActivities()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ActivityStack-resumeTopActivityUncheckedLocked"><span class="nav-number">2.8.</span> <span class="nav-text">ActivityStack.resumeTopActivityUncheckedLocked()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ActivityStackSupervisor-startSpecificActivity"><span class="nav-number">2.9.</span> <span class="nav-text">ActivityStackSupervisor.startSpecificActivity()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ActivityStackSupervisor-realStartActivityLocked"><span class="nav-number">2.10.</span> <span class="nav-text">ActivityStackSupervisor.realStartActivityLocked()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A7%E8%A1%8CLaunchActivityItem%E4%BA%8B%E5%8A%A1"><span class="nav-number">2.11.</span> <span class="nav-text">æ‰§è¡ŒLaunchActivityItemäº‹åŠ¡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LaunchActivityItem"><span class="nav-number">2.12.</span> <span class="nav-text">LaunchActivityItem</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Tinlone"
      src="/images/favicon-32x32-next.png">
  <p class="site-author-name" itemprop="name">Tinlone</p>
  <div class="site-description" itemprop="description">Tinloneçš„ä¸ªäººåšå®¢</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
	
	<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=16435049&auto=1&height=66"></iframe>
	
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tinlone</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">53k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">48 åˆ†é’Ÿ</span>
</div>
<!--
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>
-->

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
